<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.srcML.org/srcML/src" revision="1.0.0" language="Java" filename="/Users/wang/Documents/project/configuration_code_understanding/code3/data/system/xmlgraphics-batik/batik-svggen/src/main/java/org/apache/batik/svggen/SVGGraphics2D.java"><comment type="block">/*

   Licensed to the Apache Software Foundation (ASF) under one or more
   contributor license agreements.  See the NOTICE file distributed with
   this work for additional information regarding copyright ownership.
   The ASF licenses this file to You under the Apache License, Version 2.0
   (the "License"); you may not use this file except in compliance with
   the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.

 */</comment>

<package>package <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>batik</name><operator>.</operator><name>svggen</name></name>;</package>

<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>BasicStroke</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>Color</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>Dimension</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>Font</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>FontMetrics</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>Graphics</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>Graphics2D</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>GraphicsConfiguration</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>Image</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>Paint</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>Shape</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>Stroke</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>font</name><operator>.</operator><name>GlyphVector</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>font</name><operator>.</operator><name>TextAttribute</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>font</name><operator>.</operator><name>TextLayout</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>geom</name><operator>.</operator><name>AffineTransform</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>geom</name><operator>.</operator><name>NoninvertibleTransformException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>image</name><operator>.</operator><name>BufferedImage</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>image</name><operator>.</operator><name>BufferedImageOp</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>image</name><operator>.</operator><name>ImageObserver</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>image</name><operator>.</operator><name>RenderedImage</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>awt</name><operator>.</operator><name>image</name><operator>.</operator><name>renderable</name><operator>.</operator><name>RenderableImage</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>FileOutputStream</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>IOException</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>OutputStreamWriter</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>io</name><operator>.</operator><name>Writer</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>text</name><operator>.</operator><name>AttributedCharacterIterator</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>HashSet</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Map</name></name>;</import>
<import>import <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>Set</name></name>;</import>

<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>batik</name><operator>.</operator><name>ext</name><operator>.</operator><name>awt</name><operator>.</operator><name>g2d</name><operator>.</operator><name>AbstractGraphics2D</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>apache</name><operator>.</operator><name>batik</name><operator>.</operator><name>ext</name><operator>.</operator><name>awt</name><operator>.</operator><name>g2d</name><operator>.</operator><name>GraphicContext</name></name>;</import>

<import>import <name><name>org</name><operator>.</operator><name>w3c</name><operator>.</operator><name>dom</name><operator>.</operator><name>Document</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>w3c</name><operator>.</operator><name>dom</name><operator>.</operator><name>DocumentFragment</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>w3c</name><operator>.</operator><name>dom</name><operator>.</operator><name>Element</name></name>;</import>
<import>import <name><name>org</name><operator>.</operator><name>w3c</name><operator>.</operator><name>dom</name><operator>.</operator><name>Node</name></name>;</import>

<comment type="block" format="javadoc">/**
 * This implementation of the java.awt.Graphics2D abstract class
 * allows users to generate SVG (Scalable Vector Graphics) content
 * from Java code.
 *
 * SVGGraphics2D generates a DOM tree whose root is obtained through
 * the getRoot method. Refer to the DOMTreeManager and DOMGroupManager
 * documentation for details on the structure of the generated
 * DOM tree.
 *
 * The SVGGraphics2D class can produce a DOM tree using any implementation
 * that conforms to the W3C DOM 1.0 specification (see http://www.w3.org).
 * At construction time, the SVGGraphics2D must be given a org.w3.dom.Document
 * instance that is used as a factory to create the various nodes in the
 * DOM tree it generates.
 *
 * The various graphic context attributes (e.g., AffineTransform,
 * Paint) are managed by a GraphicContext object.
 *
 *
 * @author &lt;a href="mailto:vincent.hardy@eng.sun.com"&gt;Vincent Hardy&lt;/a&gt;
 * @version $Id$
 * @see                org.apache.batik.ext.awt.g2d.GraphicContext
 * @see                org.apache.batik.svggen.DOMTreeManager
 * @see                org.apache.batik.svggen.DOMGroupManager
 * @see                org.apache.batik.svggen.ImageHandler
 * @see                org.apache.batik.svggen.ExtensionHandler
 * @see                org.w3c.dom.Document
 */</comment>
<class><specifier>public</specifier> class <name>SVGGraphics2D</name> <super_list><extends>extends <super><name>AbstractGraphics2D</name></super></extends>
    <implements>implements <super><name>Cloneable</name></super>, <super><name>SVGSyntax</name></super>, <super><name>ErrorConstants</name></super></implements></super_list> <block>{

    <comment type="block">/*
     * Constants definitions
     */</comment>
    <decl_stmt><decl><type><specifier>public</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>String</name></type> <name>DEFAULT_XML_ENCODING</name> <init>= <expr><literal type="string">"ISO-8859-1"</literal></expr></init></decl>;</decl_stmt>

    <comment type="block" format="javadoc">/**
     * Controls the policy for grouping nodes. Once the number of attributes
     * overridden by a child element is greater than DEFAULT_MAX_GC_OVERRIDES,
     * a new group is created.
     *
     * @see org.apache.batik.svggen.DOMTreeManager
     */</comment>
    <decl_stmt><decl><type><specifier>public</specifier> <specifier>static</specifier> <specifier>final</specifier> <name>int</name></type> <name>DEFAULT_MAX_GC_OVERRIDES</name> <init>= <expr><literal type="number">3</literal></expr></init></decl>;</decl_stmt>


    <comment type="block" format="javadoc">/**
     * The DOMTreeManager manages the process of creating
     * and growing the SVG tree. This SVGGraphics2D relies on
     * the DOMTreeManager to process attributes based on the
     * GraphicContext state and create groups when needed.
     */</comment>
    <decl_stmt><decl><type><specifier>protected</specifier> <name>DOMTreeManager</name></type> <name>domTreeManager</name></decl>;</decl_stmt>

    <comment type="block" format="javadoc">/**
     * The DOMGroupManager manages additions to the current group
     * node associated for this Graphics2D object. Once a group
     * is complete, the group manager appends it to the DOM tree
     * through the DOMTreeManager.
     * Note that each SVGGraphics2D instance has its own DOMGroupManager
     * (i.e., its own current group) but that all SVGGraphics2D
     * originating from the same SVGGraphics2D through various
     * createGraphics calls share the same DOMTreeManager.
     */</comment>
    <decl_stmt><decl><type><specifier>protected</specifier> <name>DOMGroupManager</name></type> <name>domGroupManager</name></decl>;</decl_stmt>

    <comment type="block" format="javadoc">/**
     * Contains some information for SVG generation.
     */</comment>
    <decl_stmt><decl><type><specifier>protected</specifier> <name>SVGGeneratorContext</name></type> <name>generatorCtx</name></decl>;</decl_stmt>

    <comment type="block" format="javadoc">/**
     * Used to convert Java 2D API Shape objects to equivalent SVG
     * elements
     */</comment>
    <decl_stmt><decl><type><specifier>protected</specifier> <name>SVGShape</name></type> <name>shapeConverter</name></decl>;</decl_stmt>

    <comment type="block" format="javadoc">/**
     * SVG Canvas size
     */</comment>
    <decl_stmt><decl><type><specifier>protected</specifier> <name>Dimension</name></type> <name>svgCanvasSize</name></decl>;</decl_stmt>

    <comment type="block" format="javadoc">/**
     * Used to create proper font metrics
     */</comment>
    <decl_stmt><decl><type><specifier>protected</specifier> <name>Graphics2D</name></type> <name>fmg</name></decl>;</decl_stmt>

    <block>{<block_content>
        <decl_stmt><decl><type><name>BufferedImage</name></type> <name>bi</name>
            <init>= <expr><operator>new</operator> <call><name>BufferedImage</name><argument_list>(<argument><expr><literal type="number">1</literal></expr></argument>, <argument><expr><literal type="number">1</literal></expr></argument>, <argument><expr><name><name>BufferedImage</name><operator>.</operator><name>TYPE_INT_ARGB</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

        <expr_stmt><expr><name>fmg</name> <operator>=</operator> <call><name><name>bi</name><operator>.</operator><name>createGraphics</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block>

    <comment type="block" format="javadoc">/**
     * @return SVG Canvas size, as set in the root svg element
     */</comment>
    <function><type><specifier>public</specifier> <specifier>final</specifier> <name>Dimension</name></type> <name>getSVGCanvasSize</name><parameter_list>()</parameter_list><block>{<block_content>
        <return>return <expr><name>svgCanvasSize</name></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Set the Canvas size, this is used to set the width and
     * height attributes on the outermost 'svg' element.
     * @param svgCanvasSize SVG Canvas size. May be null (equivalent
     * to 100%, 100%)
     */</comment>
    <function><type><specifier>public</specifier> <specifier>final</specifier> <name>void</name></type> <name>setSVGCanvasSize</name><parameter_list>(<parameter><decl><type><name>Dimension</name></type> <name>svgCanvasSize</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>svgCanvasSize</name></name> <operator>=</operator> <operator>new</operator> <call><name>Dimension</name><argument_list>(<argument><expr><name>svgCanvasSize</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * @return the SVGGeneratorContext used by this SVGGraphics2D instance.
     */</comment>
    <function><type><specifier>public</specifier> <specifier>final</specifier> <name>SVGGeneratorContext</name></type> <name>getGeneratorContext</name><parameter_list>()</parameter_list> <block>{<block_content>
        <return>return <expr><name>generatorCtx</name></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * @return the SVGShape used by this SVGGraphics2D instance to
     *         turn Java2D shapes into SVG Shape objects.
     */</comment>
    <function><type><specifier>public</specifier> <specifier>final</specifier> <name>SVGShape</name></type> <name>getShapeConverter</name><parameter_list>()</parameter_list> <block>{<block_content>
        <return>return <expr><name>shapeConverter</name></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * @return the DOMTreeManager used by this SVGGraphics2D instance
     */</comment>
    <function><type><specifier>public</specifier> <specifier>final</specifier> <name>DOMTreeManager</name></type> <name>getDOMTreeManager</name><parameter_list>()</parameter_list><block>{<block_content>
        <return>return <expr><name>domTreeManager</name></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Set a DOM Tree manager for the SVGGraphics2D.
     * @param treeMgr the new DOM Tree manager this SVGGraphics2D should use
     */</comment>
     <function><type><specifier>protected</specifier> <specifier>final</specifier> <name>void</name></type> <name>setDOMTreeManager</name><parameter_list>(<parameter><decl><type><name>DOMTreeManager</name></type> <name>treeMgr</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>domTreeManager</name></name> <operator>=</operator> <name>treeMgr</name></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>generatorCtx</name><operator>.</operator><name>genericImageHandler</name><operator>.</operator><name>setDOMTreeManager</name></name><argument_list>(<argument><expr><name>domTreeManager</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></function>

     <comment type="block" format="javadoc">/**
     * @return the DOMGroupManager used by this SVGGraphics2D instance
     */</comment>
    <function><type><specifier>protected</specifier> <specifier>final</specifier> <name>DOMGroupManager</name></type> <name>getDOMGroupManager</name><parameter_list>()</parameter_list><block>{<block_content>
        <return>return <expr><name>domGroupManager</name></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Set a new DOM Group manager for this SVGGraphics2D.
     * @param groupMgr the new DOM Group manager this SVGGraphics2D should use
     */</comment>
     <function><type><specifier>protected</specifier> <specifier>final</specifier> <name>void</name></type> <name>setDOMGroupManager</name><parameter_list>(<parameter><decl><type><name>DOMGroupManager</name></type> <name>groupMgr</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>domGroupManager</name></name> <operator>=</operator> <name>groupMgr</name></expr>;</expr_stmt>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * @return the Document used as a DOM object factory by this
     *         SVGGraphics2D instance
     */</comment>
    <function><type><specifier>public</specifier> <specifier>final</specifier> <name>Document</name></type> <name>getDOMFactory</name><parameter_list>()</parameter_list><block>{<block_content>
        <return>return <expr><name><name>generatorCtx</name><operator>.</operator><name>domFactory</name></name></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * @return the ImageHandler used by this SVGGraphics2D instance
     */</comment>
    <function><type><specifier>public</specifier> <specifier>final</specifier> <name>ImageHandler</name></type> <name>getImageHandler</name><parameter_list>()</parameter_list><block>{<block_content>
        <return>return <expr><name><name>generatorCtx</name><operator>.</operator><name>imageHandler</name></name></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * @return the GenericImageHandler used by this SVGGraphics2D instance
     */</comment>
    <function><type><specifier>public</specifier> <specifier>final</specifier> <name>GenericImageHandler</name></type> <name>getGenericImageHandler</name><parameter_list>()</parameter_list><block>{<block_content>
        <return>return <expr><name><name>generatorCtx</name><operator>.</operator><name>genericImageHandler</name></name></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * @return the extension handler used by this SVGGraphics2D instance
     */</comment>
    <function><type><specifier>public</specifier> <specifier>final</specifier> <name>ExtensionHandler</name></type> <name>getExtensionHandler</name><parameter_list>()</parameter_list><block>{<block_content>
        <return>return <expr><name><name>generatorCtx</name><operator>.</operator><name>extensionHandler</name></name></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * @param extensionHandler new extension handler this SVGGraphics2D
     *        should use
     */</comment>
    <function><type><specifier>public</specifier> <specifier>final</specifier> <name>void</name></type> <name>setExtensionHandler</name><parameter_list>(<parameter><decl><type><name>ExtensionHandler</name></type> <name>extensionHandler</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <expr_stmt><expr><call><name><name>generatorCtx</name><operator>.</operator><name>setExtensionHandler</name></name><argument_list>(<argument><expr><name>extensionHandler</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * @param domFactory Factory which will produce Elements for the DOM tree
     *        this Graphics2D generates.
     * @exception SVGGraphics2DRuntimeException if domFactory is null.
     */</comment>
    <constructor><specifier>public</specifier> <name>SVGGraphics2D</name><parameter_list>(<parameter><decl><type><name>Document</name></type> <name>domFactory</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <expr_stmt><expr><call><name>this</name><argument_list>(<argument><expr><call><name><name>SVGGeneratorContext</name><operator>.</operator><name>createDefault</name></name><argument_list>(<argument><expr><name>domFactory</name></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></constructor>

    <comment type="block" format="javadoc">/**
     * @param domFactory Factory which will produce Elements for the DOM tree
     *                   this Graphics2D generates.
     * @param imageHandler defines how images are referenced in the
     *                     generated SVG fragment
     * @param extensionHandler defines how Java 2D API extensions map
     *                         to SVG Nodes.
     * @param textAsShapes if true, all text is turned into SVG shapes in the
     *        convertion. No SVG text is output.
     *
     * @exception SVGGraphics2DRuntimeException if domFactory is null.
     */</comment>
    <constructor><specifier>public</specifier> <name>SVGGraphics2D</name><parameter_list>(<parameter><decl><type><name>Document</name></type> <name>domFactory</name></decl></parameter>,
                         <parameter><decl><type><name>ImageHandler</name></type> <name>imageHandler</name></decl></parameter>,
                         <parameter><decl><type><name>ExtensionHandler</name></type> <name>extensionHandler</name></decl></parameter>,
                         <parameter><decl><type><name>boolean</name></type> <name>textAsShapes</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <expr_stmt><expr><call><name>this</name><argument_list>(<argument><expr><call><name>buildSVGGeneratorContext</name><argument_list>(<argument><expr><name>domFactory</name></expr></argument>,
                                      <argument><expr><name>imageHandler</name></expr></argument>,
                                      <argument><expr><name>extensionHandler</name></expr></argument>)</argument_list></call></expr></argument>,
             <argument><expr><name>textAsShapes</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></constructor>

    <comment type="block" format="javadoc">/**
     * Helper method to create an &lt;code&gt;SVGGeneratorContext&lt;/code&gt; from the
     * constructor parameters.
     */</comment>
    <function><type><specifier>public</specifier> <specifier>static</specifier> <name>SVGGeneratorContext</name></type>
        <name>buildSVGGeneratorContext</name><parameter_list>(<parameter><decl><type><name>Document</name></type> <name>domFactory</name></decl></parameter>,
                                 <parameter><decl><type><name>ImageHandler</name></type> <name>imageHandler</name></decl></parameter>,
                                 <parameter><decl><type><name>ExtensionHandler</name></type> <name>extensionHandler</name></decl></parameter>)</parameter_list><block>{<block_content>

        <decl_stmt><decl><type><name>SVGGeneratorContext</name></type> <name>generatorCtx</name> <init>= <expr><operator>new</operator> <call><name>SVGGeneratorContext</name><argument_list>(<argument><expr><name>domFactory</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <expr_stmt><expr><call><name><name>generatorCtx</name><operator>.</operator><name>setIDGenerator</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>SVGIDGenerator</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>generatorCtx</name><operator>.</operator><name>setExtensionHandler</name></name><argument_list>(<argument><expr><name>extensionHandler</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>generatorCtx</name><operator>.</operator><name>setImageHandler</name></name><argument_list>(<argument><expr><name>imageHandler</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>generatorCtx</name><operator>.</operator><name>setStyleHandler</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>DefaultStyleHandler</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>generatorCtx</name><operator>.</operator><name>setComment</name></name><argument_list>(<argument><expr><literal type="string">"Generated by the Batik Graphics2D SVG Generator"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>generatorCtx</name><operator>.</operator><name>setErrorHandler</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>DefaultErrorHandler</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <return>return <expr><name>generatorCtx</name></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Creates a new SVGGraphics2D object.
     * @param generatorCtx the &lt;code&gt;SVGGeneratorContext&lt;/code&gt; instance
     * that will provide all useful information to the generator.
     * @param textAsShapes if true, all text is turned into SVG shapes in the
     *        convertion. No SVG text is output.
     *
     * @exception SVGGraphics2DRuntimeException if generatorContext is null.
     */</comment>
    <constructor><specifier>public</specifier> <name>SVGGraphics2D</name><parameter_list>(<parameter><decl><type><name>SVGGeneratorContext</name></type> <name>generatorCtx</name></decl></parameter>,
                         <parameter><decl><type><name>boolean</name></type> <name>textAsShapes</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <expr_stmt><expr><call><name>super</name><argument_list>(<argument><expr><name>textAsShapes</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <if_stmt><if>if <condition>(<expr><name>generatorCtx</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition><block type="pseudo"><block_content>
            <comment type="line">// no error handler here as we don't have the ctx...</comment>
            <throw>throw <expr><operator>new</operator> <call><name>SVGGraphics2DRuntimeException</name><argument_list>(<argument><expr><name>ERR_CONTEXT_NULL</name></expr></argument>)</argument_list></call></expr>;</throw></block_content></block></if></if_stmt>

        <expr_stmt><expr><call><name>setGeneratorContext</name><argument_list>(<argument><expr><name>generatorCtx</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></constructor>

    <comment type="block" format="javadoc">/**
     * Sets an non null &lt;code&gt;SVGGeneratorContext&lt;/code&gt;.
     */</comment>
    <function><type><specifier>protected</specifier> <name>void</name></type> <name>setGeneratorContext</name><parameter_list>(<parameter><decl><type><name>SVGGeneratorContext</name></type> <name>generatorCtx</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>generatorCtx</name></name> <operator>=</operator> <name>generatorCtx</name></expr>;</expr_stmt>

        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>gc</name></name> <operator>=</operator> <operator>new</operator> <call><name>GraphicContext</name><argument_list>(<argument><expr><operator>new</operator> <call><name>AffineTransform</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <decl_stmt><decl><type><name><name>SVGGeneratorContext</name><operator>.</operator><name>GraphicContextDefaults</name></name></type> <name>gcDefaults</name> <init>=
            <expr><call><name><name>generatorCtx</name><operator>.</operator><name>getGraphicContextDefaults</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>

        <if_stmt><if>if<condition>(<expr><name>gcDefaults</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><block>{<block_content>
            <if_stmt><if>if<condition>(<expr><call><name><name>gcDefaults</name><operator>.</operator><name>getPaint</name></name><argument_list>()</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><block>{<block_content>
                <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>setPaint</name></name><argument_list>(<argument><expr><call><name><name>gcDefaults</name><operator>.</operator><name>getPaint</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block></if></if_stmt>
            <if_stmt><if>if<condition>(<expr><call><name><name>gcDefaults</name><operator>.</operator><name>getStroke</name></name><argument_list>()</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><block>{<block_content>
                <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>setStroke</name></name><argument_list>(<argument><expr><call><name><name>gcDefaults</name><operator>.</operator><name>getStroke</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block></if></if_stmt>
            <if_stmt><if>if<condition>(<expr><call><name><name>gcDefaults</name><operator>.</operator><name>getComposite</name></name><argument_list>()</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><block>{<block_content>
                <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>setComposite</name></name><argument_list>(<argument><expr><call><name><name>gcDefaults</name><operator>.</operator><name>getComposite</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block></if></if_stmt>
            <if_stmt><if>if<condition>(<expr><call><name><name>gcDefaults</name><operator>.</operator><name>getClip</name></name><argument_list>()</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><block>{<block_content>
                <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>setClip</name></name><argument_list>(<argument><expr><call><name><name>gcDefaults</name><operator>.</operator><name>getClip</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block></if></if_stmt>
            <if_stmt><if>if<condition>(<expr><call><name><name>gcDefaults</name><operator>.</operator><name>getRenderingHints</name></name><argument_list>()</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><block>{<block_content>
                <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>setRenderingHints</name></name><argument_list>(<argument><expr><call><name><name>gcDefaults</name><operator>.</operator><name>getRenderingHints</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block></if></if_stmt>
            <if_stmt><if>if<condition>(<expr><call><name><name>gcDefaults</name><operator>.</operator><name>getFont</name></name><argument_list>()</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><block>{<block_content>
                <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>setFont</name></name><argument_list>(<argument><expr><call><name><name>gcDefaults</name><operator>.</operator><name>getFont</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block></if></if_stmt>
            <if_stmt><if>if<condition>(<expr><call><name><name>gcDefaults</name><operator>.</operator><name>getBackground</name></name><argument_list>()</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><block>{<block_content>
                <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>setBackground</name></name><argument_list>(<argument><expr><call><name><name>gcDefaults</name><operator>.</operator><name>getBackground</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block></if></if_stmt>
        </block_content>}</block></if></if_stmt>

        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>shapeConverter</name></name> <operator>=</operator> <operator>new</operator> <call><name>SVGShape</name><argument_list>(<argument><expr><name>generatorCtx</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>domTreeManager</name></name> <operator>=</operator> <operator>new</operator> <call><name>DOMTreeManager</name><argument_list>(<argument><expr><name>gc</name></expr></argument>,
                                                 <argument><expr><name>generatorCtx</name></expr></argument>,
                                                 <argument><expr><name>DEFAULT_MAX_GC_OVERRIDES</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>domGroupManager</name></name> <operator>=</operator> <operator>new</operator> <call><name>DOMGroupManager</name><argument_list>(<argument><expr><name>gc</name></expr></argument>, <argument><expr><name>domTreeManager</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>this</name><operator>.</operator><name>domTreeManager</name><operator>.</operator><name>addGroupManager</name></name><argument_list>(<argument><expr><name>domGroupManager</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>generatorCtx</name><operator>.</operator><name>genericImageHandler</name><operator>.</operator><name>setDOMTreeManager</name></name><argument_list>(<argument><expr><name>domTreeManager</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * This constructor is used in create()
     *
     * @see #create
     */</comment>
    <constructor><specifier>public</specifier> <name>SVGGraphics2D</name><parameter_list>(<parameter><decl><type><name>SVGGraphics2D</name></type> <name>g</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <expr_stmt><expr><call><name>super</name><argument_list>(<argument><expr><name>g</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>generatorCtx</name></name> <operator>=</operator> <name><name>g</name><operator>.</operator><name>generatorCtx</name></name></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>this</name><operator>.</operator><name>gc</name><operator>.</operator><name>validateTransformStack</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>shapeConverter</name></name> <operator>=</operator> <name><name>g</name><operator>.</operator><name>shapeConverter</name></name></expr>;</expr_stmt>
        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>domTreeManager</name></name> <operator>=</operator> <name><name>g</name><operator>.</operator><name>domTreeManager</name></name></expr>;</expr_stmt>
        <expr_stmt><expr><name><name>this</name><operator>.</operator><name>domGroupManager</name></name> <operator>=</operator> <operator>new</operator> <call><name>DOMGroupManager</name><argument_list>(<argument><expr><name><name>this</name><operator>.</operator><name>gc</name></name></expr></argument>, <argument><expr><name><name>this</name><operator>.</operator><name>domTreeManager</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>this</name><operator>.</operator><name>domTreeManager</name><operator>.</operator><name>addGroupManager</name></name><argument_list>(<argument><expr><name><name>this</name><operator>.</operator><name>domGroupManager</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></constructor>

    <comment type="block" format="javadoc">/**
     * @param svgFileName name of the file where SVG content
     *        should be written
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>stream</name><parameter_list>(<parameter><decl><type><name>String</name></type> <name>svgFileName</name></decl></parameter>)</parameter_list> <throws>throws <argument><expr><name>SVGGraphics2DIOException</name></expr></argument></throws> <block>{<block_content>
        <expr_stmt><expr><call><name>stream</name><argument_list>(<argument><expr><name>svgFileName</name></expr></argument>, <argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * @param svgFileName name of the file where SVG content
     *        should be written
     * @param useCss defines whether the output SVG should use CSS style
     * properties as opposed to plain attributes.
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>stream</name><parameter_list>(<parameter><decl><type><name>String</name></type> <name>svgFileName</name></decl></parameter>, <parameter><decl><type><name>boolean</name></type> <name>useCss</name></decl></parameter>)</parameter_list>
        <throws>throws <argument><expr><name>SVGGraphics2DIOException</name></expr></argument></throws> <block>{<block_content>
        <try>try <block>{<block_content>
            <decl_stmt><decl><type><name>OutputStreamWriter</name></type> <name>writer</name> <init>=
                <expr><operator>new</operator> <call><name>OutputStreamWriter</name><argument_list>(<argument><expr><operator>new</operator> <call><name>FileOutputStream</name><argument_list>(<argument><expr><name>svgFileName</name></expr></argument>)</argument_list></call></expr></argument>,
                                       <argument><expr><name>DEFAULT_XML_ENCODING</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
            <expr_stmt><expr><call><name>stream</name><argument_list>(<argument><expr><name>writer</name></expr></argument>, <argument><expr><name>useCss</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>writer</name><operator>.</operator><name>flush</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>writer</name><operator>.</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block> <catch>catch <parameter_list>(<parameter><decl><type><name>SVGGraphics2DIOException</name></type> <name>io</name></decl></parameter>)</parameter_list> <block>{<block_content>
            <comment type="line">// this one as already been handled in stream(Writer, boolean)</comment>
            <comment type="line">// method =&gt; rethrow it in all cases</comment>
            <throw>throw <expr><name>io</name></expr>;</throw>
        </block_content>}</block></catch> <catch>catch <parameter_list>(<parameter><decl><type><name>IOException</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
            <expr_stmt><expr><call><name><name>generatorCtx</name><operator>.</operator><name>errorHandler</name><operator>.</operator>
                <name>handleError</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>SVGGraphics2DIOException</name><argument_list>(<argument><expr><name>e</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></catch></try>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * @param writer used to writer out the SVG content
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>stream</name><parameter_list>(<parameter><decl><type><name>Writer</name></type> <name>writer</name></decl></parameter>)</parameter_list> <throws>throws <argument><expr><name>SVGGraphics2DIOException</name></expr></argument></throws> <block>{<block_content>
        <expr_stmt><expr><call><name>stream</name><argument_list>(<argument><expr><name>writer</name></expr></argument>, <argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * @param writer used to writer out the SVG content
     * @param useCss defines whether the output SVG should use CSS
     * @param escaped defines if the characters will be escaped
     * style properties as opposed to plain attributes.
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>stream</name><parameter_list>(<parameter><decl><type><name>Writer</name></type> <name>writer</name></decl></parameter>, <parameter><decl><type><name>boolean</name></type> <name>useCss</name></decl></parameter>, <parameter><decl><type><name>boolean</name></type> <name>escaped</name></decl></parameter>)</parameter_list>
        <throws>throws <argument><expr><name>SVGGraphics2DIOException</name></expr></argument></throws> <block>{<block_content>
        <decl_stmt><decl><type><name>Element</name></type> <name>svgRoot</name> <init>= <expr><call><name>getRoot</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <expr_stmt><expr><call><name>stream</name><argument_list>(<argument><expr><name>svgRoot</name></expr></argument>, <argument><expr><name>writer</name></expr></argument>, <argument><expr><name>useCss</name></expr></argument>, <argument><expr><name>escaped</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * @param writer used to writer out the SVG content
     * @param useCss defines whether the output SVG should use CSS
     * style properties as opposed to plain attributes.
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>stream</name><parameter_list>(<parameter><decl><type><name>Writer</name></type> <name>writer</name></decl></parameter>, <parameter><decl><type><name>boolean</name></type> <name>useCss</name></decl></parameter>)</parameter_list>
        <throws>throws <argument><expr><name>SVGGraphics2DIOException</name></expr></argument></throws> <block>{<block_content>
        <decl_stmt><decl><type><name>Element</name></type> <name>svgRoot</name> <init>= <expr><call><name>getRoot</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <expr_stmt><expr><call><name>stream</name><argument_list>(<argument><expr><name>svgRoot</name></expr></argument>, <argument><expr><name>writer</name></expr></argument>, <argument><expr><name>useCss</name></expr></argument>, <argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * @param svgRoot root element to stream out
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>stream</name><parameter_list>(<parameter><decl><type><name>Element</name></type> <name>svgRoot</name></decl></parameter>, <parameter><decl><type><name>Writer</name></type> <name>writer</name></decl></parameter>)</parameter_list>
        <throws>throws <argument><expr><name>SVGGraphics2DIOException</name></expr></argument></throws> <block>{<block_content>
        <expr_stmt><expr><call><name>stream</name><argument_list>(<argument><expr><name>svgRoot</name></expr></argument>, <argument><expr><name>writer</name></expr></argument>, <argument><expr><literal type="boolean">false</literal></expr></argument>, <argument><expr><literal type="boolean">false</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * @param svgRoot root element to stream out
     * @param writer output
     * @param useCss defines whether the output SVG should use CSS style
     * @param escaped defines if the characters will be escaped
     * properties as opposed to plain attributes.
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>stream</name><parameter_list>(<parameter><decl><type><name>Element</name></type> <name>svgRoot</name></decl></parameter>, <parameter><decl><type><name>Writer</name></type> <name>writer</name></decl></parameter>, <parameter><decl><type><name>boolean</name></type> <name>useCss</name></decl></parameter>, <parameter><decl><type><name>boolean</name></type> <name>escaped</name></decl></parameter>)</parameter_list>
        <throws>throws <argument><expr><name>SVGGraphics2DIOException</name></expr></argument></throws> <block>{<block_content>
        <decl_stmt><decl><type><name>Node</name></type> <name>rootParent</name> <init>= <expr><call><name><name>svgRoot</name><operator>.</operator><name>getParentNode</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>Node</name></type> <name>nextSibling</name> <init>= <expr><call><name><name>svgRoot</name><operator>.</operator><name>getNextSibling</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>

        <try>try <block>{<block_content>
            <comment type="line">//</comment>
            <comment type="line">// Enforce that the default and xlink namespace</comment>
            <comment type="line">// declarations appear on the root element</comment>
            <comment type="line">//</comment>
            <expr_stmt><expr><call><name><name>svgRoot</name><operator>.</operator><name>setAttributeNS</name></name><argument_list>(<argument><expr><name>XMLNS_NAMESPACE_URI</name></expr></argument>,
                                   <argument><expr><name>XMLNS_PREFIX</name></expr></argument>,
                                   <argument><expr><name>SVG_NAMESPACE_URI</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

            <expr_stmt><expr><call><name><name>svgRoot</name><operator>.</operator><name>setAttributeNS</name></name><argument_list>(<argument><expr><name>XMLNS_NAMESPACE_URI</name></expr></argument>,
                                   <argument><expr><name>XMLNS_PREFIX</name> <operator>+</operator> <literal type="string">":"</literal> <operator>+</operator> <name>XLINK_PREFIX</name></expr></argument>,
                                   <argument><expr><name>XLINK_NAMESPACE_URI</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

            <decl_stmt><decl><type><name>DocumentFragment</name></type> <name>svgDocument</name> <init>=
                <expr><call><name><name>svgRoot</name><operator>.</operator><name>getOwnerDocument</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>createDocumentFragment</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
            <expr_stmt><expr><call><name><name>svgDocument</name><operator>.</operator><name>appendChild</name></name><argument_list>(<argument><expr><name>svgRoot</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

            <if_stmt><if>if <condition>(<expr><name>useCss</name></expr>)</condition><block type="pseudo"><block_content>
                <expr_stmt><expr><call><name><name>SVGCSSStyler</name><operator>.</operator><name>style</name></name><argument_list>(<argument><expr><name>svgDocument</name></expr></argument>)</argument_list></call></expr>;</expr_stmt></block_content></block></if></if_stmt>

            <expr_stmt><expr><call><name><name>XmlWriter</name><operator>.</operator><name>writeXml</name></name><argument_list>(<argument><expr><name>svgDocument</name></expr></argument>, <argument><expr><name>writer</name></expr></argument>, <argument><expr><name>escaped</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>writer</name><operator>.</operator><name>flush</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block> <catch>catch <parameter_list>(<parameter><decl><type><name>SVGGraphics2DIOException</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
            <comment type="line">// this catch prevents from catching an SVGGraphics2DIOException</comment>
            <comment type="line">// and wrapping it again in another SVGGraphics2DIOException</comment>
            <comment type="line">// as would do the second catch (XmlWriter throws SVGGraphics2DIO</comment>
            <comment type="line">// Exception but flush throws IOException)</comment>
            <expr_stmt><expr><call><name><name>generatorCtx</name><operator>.</operator><name>errorHandler</name><operator>.</operator>
                <name>handleError</name></name><argument_list>(<argument><expr><name>e</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></catch> <catch>catch <parameter_list>(<parameter><decl><type><name>IOException</name></type> <name>io</name></decl></parameter>)</parameter_list> <block>{<block_content>
            <expr_stmt><expr><call><name><name>generatorCtx</name><operator>.</operator><name>errorHandler</name><operator>.</operator>
                <name>handleError</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>SVGGraphics2DIOException</name><argument_list>(<argument><expr><name>io</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></catch> <finally>finally <block>{<block_content>
            <comment type="line">// Restore the svgRoot to its original tree position</comment>
            <if_stmt><if>if <condition>(<expr><name>rootParent</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
                <if_stmt><if>if <condition>(<expr><name>nextSibling</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
                    <expr_stmt><expr><call><name><name>rootParent</name><operator>.</operator><name>appendChild</name></name><argument_list>(<argument><expr><name>svgRoot</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
                </block_content>}</block></if> <else>else <block>{<block_content>
                    <expr_stmt><expr><call><name><name>rootParent</name><operator>.</operator><name>insertBefore</name></name><argument_list>(<argument><expr><name>svgRoot</name></expr></argument>, <argument><expr><name>nextSibling</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
                </block_content>}</block></else></if_stmt>
            </block_content>}</block></if></if_stmt>
        </block_content>}</block></finally></try>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Invoking this method will return a set of definition element that
     * contain all the definitions referenced by the attributes generated by
     * the various converters. This also resets the converters.
     */</comment>
    <function><type><specifier>public</specifier> <name><name>java</name><operator>.</operator><name>util</name><operator>.</operator><name>List</name></name></type> <name>getDefinitionSet</name><parameter_list>()</parameter_list><block>{<block_content>
        <return>return <expr><call><name><name>domTreeManager</name><operator>.</operator><name>getDefinitionSet</name></name><argument_list>()</argument_list></call></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Invoking this method will return a reference to the topLevelGroup
     * Element managed by this object. It will also cause this object
     * to start working with a new topLevelGroup.
     *
     * @return top level group
     */</comment>
    <function><type><specifier>public</specifier> <name>Element</name></type> <name>getTopLevelGroup</name><parameter_list>()</parameter_list><block>{<block_content>
        <return>return <expr><call><name>getTopLevelGroup</name><argument_list>(<argument><expr><literal type="boolean">true</literal></expr></argument>)</argument_list></call></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Invoking this method will return a reference to the topLevelGroup
     * Element managed by this object. It will also cause this object
     * to start working with a new topLevelGroup.
     *
     * @param includeDefinitionSet if true, the definition set is included and
     *        the converters are reset (i.e., they start with an empty set
     *        of definitions).
     * @return top level group
     */</comment>
    <function><type><specifier>public</specifier> <name>Element</name></type> <name>getTopLevelGroup</name><parameter_list>(<parameter><decl><type><name>boolean</name></type> <name>includeDefinitionSet</name></decl></parameter>)</parameter_list><block>{<block_content>
        <return>return <expr><call><name><name>domTreeManager</name><operator>.</operator><name>getTopLevelGroup</name></name><argument_list>(<argument><expr><name>includeDefinitionSet</name></expr></argument>)</argument_list></call></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Sets the topLevelGroup to the input element. This will throw an exception
     * if the input element is not of type 'g' or if it is null.
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>setTopLevelGroup</name><parameter_list>(<parameter><decl><type><name>Element</name></type> <name>topLevelGroup</name></decl></parameter>)</parameter_list><block>{<block_content>
        <expr_stmt><expr><call><name><name>domTreeManager</name><operator>.</operator><name>setTopLevelGroup</name></name><argument_list>(<argument><expr><name>topLevelGroup</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * @return the svg root node of the SVG document associated with this
     *         object
     */</comment>
    <function><type><specifier>public</specifier> <name>Element</name></type> <name>getRoot</name><parameter_list>()</parameter_list><block>{<block_content>
        <return>return <expr><call><name>getRoot</name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * This version of the getRoot method will append the input svgRoot
     * and set its attributes.
     *
     * @param svgRoot an SVG element underwhich the content should
     *        be appended.
     * @return the svg root node of the SVG document associated with
     *         this object.
     */</comment>
    <function><type><specifier>public</specifier> <name>Element</name></type> <name>getRoot</name><parameter_list>(<parameter><decl><type><name>Element</name></type> <name>svgRoot</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <expr_stmt><expr><name>svgRoot</name> <operator>=</operator> <call><name><name>domTreeManager</name><operator>.</operator><name>getRoot</name></name><argument_list>(<argument><expr><name>svgRoot</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <if_stmt><if>if <condition>(<expr><name>svgCanvasSize</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><block>{<block_content>
            <expr_stmt><expr><call><name><name>svgRoot</name><operator>.</operator><name>setAttributeNS</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><name>SVG_WIDTH_ATTRIBUTE</name></expr></argument>,  <argument><expr><call><name><name>String</name><operator>.</operator><name>valueOf</name></name><argument_list>( <argument><expr><name><name>svgCanvasSize</name><operator>.</operator><name>width</name></name></expr></argument> )</argument_list></call></expr></argument> )</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>svgRoot</name><operator>.</operator><name>setAttributeNS</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><name>SVG_HEIGHT_ATTRIBUTE</name></expr></argument>, <argument><expr><call><name><name>String</name><operator>.</operator><name>valueOf</name></name><argument_list>( <argument><expr><name><name>svgCanvasSize</name><operator>.</operator><name>height</name></name></expr></argument>)</argument_list></call></expr></argument> )</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if></if_stmt>
        <return>return <expr><name>svgRoot</name></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Creates a new &lt;code&gt;Graphics&lt;/code&gt; object that is
     * a copy of this &lt;code&gt;Graphics&lt;/code&gt; object.
     * @return     a new graphics context that is a copy of
     *             this graphics context.
     */</comment>
    <function><type><specifier>public</specifier> <name>Graphics</name></type> <name>create</name><parameter_list>()</parameter_list><block>{<block_content>
        <return>return <expr><operator>new</operator> <call><name>SVGGraphics2D</name><argument_list>(<argument><expr><name>this</name></expr></argument>)</argument_list></call></expr>;</return>
    </block_content>}</block></function>


    <comment type="block" format="javadoc">/**
     * Sets the paint mode of this graphics context to alternate between
     * this graphics context's current color and the new specified color.
     * This specifies that logical pixel operations are performed in the
     * XOR mode, which alternates pixels between the current color and
     * a specified XOR color.
     * &lt;p&gt;
     * When drawing operations are performed, pixels which are the
     * current color are changed to the specified color, and vice versa.
     * &lt;p&gt;
     * Pixels that are of colors other than those two colors are changed
     * in an unpredictable but reversible manner; if the same figure is
     * drawn twice, then all pixels are restored to their original values.
     * @param     c1 the XOR alternation color
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>setXORMode</name><parameter_list>(<parameter><decl><type><name>Color</name></type> <name>c1</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <expr_stmt><expr><call><name><name>generatorCtx</name><operator>.</operator><name>errorHandler</name><operator>.</operator>
            <name>handleError</name></name><argument_list>(<argument><expr><operator>new</operator> <call><name>SVGGraphics2DRuntimeException</name><argument_list>(<argument><expr><name>ERR_XOR</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Gets the font metrics for the specified font.
     * @return    the font metrics for the specified font.
     * @param     f the specified font
     * @see       java.awt.Graphics#getFont
     * @see       java.awt.FontMetrics
     * @see       java.awt.Graphics#getFontMetrics()
     */</comment>
    <function><type><specifier>public</specifier> <name>FontMetrics</name></type> <name>getFontMetrics</name><parameter_list>(<parameter><decl><type><name>Font</name></type> <name>f</name></decl></parameter>)</parameter_list><block>{<block_content>
        <return>return <expr><call><name><name>fmg</name><operator>.</operator><name>getFontMetrics</name></name><argument_list>(<argument><expr><name>f</name></expr></argument>)</argument_list></call></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Copies an area of the component by a distance specified by
     * &lt;code&gt;dx&lt;/code&gt; and &lt;code&gt;dy&lt;/code&gt;. From the point specified
     * by &lt;code&gt;x&lt;/code&gt; and &lt;code&gt;y&lt;/code&gt;, this method
     * copies downwards and to the right.  To copy an area of the
     * component to the left or upwards, specify a negative value for
     * &lt;code&gt;dx&lt;/code&gt; or &lt;code&gt;dy&lt;/code&gt;.
     * If a portion of the source rectangle lies outside the bounds
     * of the component, or is obscured by another window or component,
     * &lt;code&gt;copyArea&lt;/code&gt; will be unable to copy the associated
     * pixels. The area that is omitted can be refreshed by calling
     * the component's &lt;code&gt;paint&lt;/code&gt; method.
     * @param       x the &lt;i&gt;x&lt;/i&gt; coordinate of the source rectangle.
     * @param       y the &lt;i&gt;y&lt;/i&gt; coordinate of the source rectangle.
     * @param       width the width of the source rectangle.
     * @param       height the height of the source rectangle.
     * @param       dx the horizontal distance to copy the pixels.
     * @param       dy the vertical distance to copy the pixels.
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>copyArea</name><parameter_list>(<parameter><decl><type><name>int</name></type> <name>x</name></decl></parameter>, <parameter><decl><type><name>int</name></type> <name>y</name></decl></parameter>, <parameter><decl><type><name>int</name></type> <name>width</name></decl></parameter>, <parameter><decl><type><name>int</name></type> <name>height</name></decl></parameter>,
                         <parameter><decl><type><name>int</name></type> <name>dx</name></decl></parameter>, <parameter><decl><type><name>int</name></type> <name>dy</name></decl></parameter>)</parameter_list><block>{<block_content>
        <comment type="line">// No-op</comment>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Draws as much of the specified image as is currently available.
     * The image is drawn with its top-left corner at
     * (&lt;i&gt;x&lt;/i&gt;,&amp;nbsp;&lt;i&gt;y&lt;/i&gt;) in this graphics context's coordinate
     * space. Transparent pixels in the image do not affect whatever
     * pixels are already there.
     * &lt;p&gt;
     * This method returns immediately in all cases, even if the
     * complete image has not yet been loaded, and it has not been dithered
     * and converted for the current output device.
     * &lt;p&gt;
     * If the image has not yet been completely loaded, then
     * &lt;code&gt;drawImage&lt;/code&gt; returns &lt;code&gt;false&lt;/code&gt;. As more of
     * the image becomes available, the process that draws the image notifies
     * the specified image observer.
     * @param    img the specified image to be drawn.
     * @param    x   the &lt;i&gt;x&lt;/i&gt; coordinate.
     * @param    y   the &lt;i&gt;y&lt;/i&gt; coordinate.
     * @param    observer    object to be notified as more of
     *                          the image is converted.
     * @see      java.awt.Image
     * @see      java.awt.image.ImageObserver
     * @see      java.awt.image.ImageObserver#imageUpdate(java.awt.Image, int, int, int, int, int)
     */</comment>
    <function><type><specifier>public</specifier> <name>boolean</name></type> <name>drawImage</name><parameter_list>(<parameter><decl><type><name>Image</name></type> <name>img</name></decl></parameter>, <parameter><decl><type><name>int</name></type> <name>x</name></decl></parameter>, <parameter><decl><type><name>int</name></type> <name>y</name></decl></parameter>,
                             <parameter><decl><type><name>ImageObserver</name></type> <name>observer</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <decl_stmt><decl><type><name>Element</name></type> <name>imageElement</name> <init>=
            <expr><call><name>getGenericImageHandler</name><argument_list>()</argument_list></call><operator>.</operator><call><name>createElement</name><argument_list>(<argument><expr><call><name>getGeneratorContext</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>AffineTransform</name></type> <name>xform</name> <init>= <expr><call><name>getGenericImageHandler</name><argument_list>()</argument_list></call><operator>.</operator><call><name>handleImage</name><argument_list>(
                                                         <argument><expr><name>img</name></expr></argument>, <argument><expr><name>imageElement</name></expr></argument>,
                                                         <argument><expr><name>x</name></expr></argument>, <argument><expr><name>y</name></expr></argument>,
                                                         <argument><expr><call><name><name>img</name><operator>.</operator><name>getWidth</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></argument>,
                                                         <argument><expr><call><name><name>img</name><operator>.</operator><name>getHeight</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr></argument>,
                                                         <argument><expr><call><name>getGeneratorContext</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

        <if_stmt><if>if <condition>(<expr><name>xform</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
            <expr_stmt><expr><call><name><name>domGroupManager</name><operator>.</operator><name>addElement</name></name><argument_list>(<argument><expr><name>imageElement</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if> <else>else <block>{<block_content>
            <decl_stmt><decl><type><name>AffineTransform</name></type> <name>inverseTransform</name> <init>= <expr><literal type="null">null</literal></expr></init></decl>;</decl_stmt>
            <try>try <block>{<block_content>
                <expr_stmt><expr><name>inverseTransform</name> <operator>=</operator> <call><name><name>xform</name><operator>.</operator><name>createInverse</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block> <catch>catch<parameter_list>(<parameter><decl><type><name>NoninvertibleTransformException</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
                <comment type="line">// This should never happen since handleImage</comment>
                <comment type="line">// always returns invertible transform</comment>
                <throw>throw <expr><operator>new</operator> <call><name>SVGGraphics2DRuntimeException</name><argument_list>(<argument><expr><name>ERR_UNEXPECTED</name></expr></argument>)</argument_list></call></expr>;</throw>
            </block_content>}</block></catch></try>
            <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>transform</name></name><argument_list>(<argument><expr><name>xform</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>domGroupManager</name><operator>.</operator><name>addElement</name></name><argument_list>(<argument><expr><name>imageElement</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>transform</name></name><argument_list>(<argument><expr><name>inverseTransform</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></else></if_stmt>
        <return>return <expr><literal type="boolean">true</literal></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Draws as much of the specified image as has already been scaled
     * to fit inside the specified rectangle.
     * &lt;p&gt;
     * The image is drawn inside the specified rectangle of this
     * graphics context's coordinate space, and is scaled if
     * necessary. Transparent pixels do not affect whatever pixels
     * are already there.
     * &lt;p&gt;
     * This method returns immediately in all cases, even if the
     * entire image has not yet been scaled, dithered, and converted
     * for the current output device.
     * If the current output representation is not yet complete, then
     * &lt;code&gt;drawImage&lt;/code&gt; returns &lt;code&gt;false&lt;/code&gt;. As more of
     * the image becomes available, the process that draws the image notifies
     * the image observer by calling its &lt;code&gt;imageUpdate&lt;/code&gt; method.
     * &lt;p&gt;
     * A scaled version of an image will not necessarily be
     * available immediately just because an unscaled version of the
     * image has been constructed for this output device.  Each size of
     * the image may be cached separately and generated from the original
     * data in a separate image production sequence.
     * @param    img    the specified image to be drawn.
     * @param    x      the &lt;i&gt;x&lt;/i&gt; coordinate.
     * @param    y      the &lt;i&gt;y&lt;/i&gt; coordinate.
     * @param    width  the width of the rectangle.
     * @param    height the height of the rectangle.
     * @param    observer    object to be notified as more of
     *                          the image is converted.
     * @see      java.awt.Image
     * @see      java.awt.image.ImageObserver
     * @see      java.awt.image.ImageObserver#imageUpdate(java.awt.Image, int, int, int, int, int)
     */</comment>
    <function><type><specifier>public</specifier> <name>boolean</name></type> <name>drawImage</name><parameter_list>(<parameter><decl><type><name>Image</name></type> <name>img</name></decl></parameter>, <parameter><decl><type><name>int</name></type> <name>x</name></decl></parameter>, <parameter><decl><type><name>int</name></type> <name>y</name></decl></parameter>,
                             <parameter><decl><type><name>int</name></type> <name>width</name></decl></parameter>, <parameter><decl><type><name>int</name></type> <name>height</name></decl></parameter>,
                             <parameter><decl><type><name>ImageObserver</name></type> <name>observer</name></decl></parameter>)</parameter_list><block>{<block_content>
        <decl_stmt><decl><type><name>Element</name></type> <name>imageElement</name> <init>=
            <expr><call><name>getGenericImageHandler</name><argument_list>()</argument_list></call><operator>.</operator><call><name>createElement</name><argument_list>(<argument><expr><call><name>getGeneratorContext</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>AffineTransform</name></type> <name>xform</name>
            <init>= <expr><call><name>getGenericImageHandler</name><argument_list>()</argument_list></call><operator>.</operator><call><name>handleImage</name><argument_list>(
                                       <argument><expr><name>img</name></expr></argument>, <argument><expr><name>imageElement</name></expr></argument>,
                                       <argument><expr><name>x</name></expr></argument>, <argument><expr><name>y</name></expr></argument>,
                                       <argument><expr><name>width</name></expr></argument>, <argument><expr><name>height</name></expr></argument>,
                                       <argument><expr><call><name>getGeneratorContext</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

        <if_stmt><if>if <condition>(<expr><name>xform</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
            <expr_stmt><expr><call><name><name>domGroupManager</name><operator>.</operator><name>addElement</name></name><argument_list>(<argument><expr><name>imageElement</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if> <else>else <block>{<block_content>
            <decl_stmt><decl><type><name>AffineTransform</name></type> <name>inverseTransform</name> <init>= <expr><literal type="null">null</literal></expr></init></decl>;</decl_stmt>
            <try>try <block>{<block_content>
                <expr_stmt><expr><name>inverseTransform</name> <operator>=</operator> <call><name><name>xform</name><operator>.</operator><name>createInverse</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block> <catch>catch<parameter_list>(<parameter><decl><type><name>NoninvertibleTransformException</name></type> <name>e</name></decl></parameter>)</parameter_list> <block>{<block_content>
                <comment type="line">// This should never happen since handleImage</comment>
                <comment type="line">// always returns invertible transform</comment>
                <throw>throw <expr><operator>new</operator> <call><name>SVGGraphics2DRuntimeException</name><argument_list>(<argument><expr><name>ERR_UNEXPECTED</name></expr></argument>)</argument_list></call></expr>;</throw>
            </block_content>}</block></catch></try>
            <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>transform</name></name><argument_list>(<argument><expr><name>xform</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>domGroupManager</name><operator>.</operator><name>addElement</name></name><argument_list>(<argument><expr><name>imageElement</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>transform</name></name><argument_list>(<argument><expr><name>inverseTransform</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></else></if_stmt>
        <return>return <expr><literal type="boolean">true</literal></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Disposes of this graphics context and releases
     * any system resources that it is using.
     * A &lt;code&gt;Graphics&lt;/code&gt; object cannot be used after
     * &lt;code&gt;dispose&lt;/code&gt;has been called.
     * &lt;p&gt;
     * When a Java program runs, a large number of &lt;code&gt;Graphics&lt;/code&gt;
     * objects can be created within a short time frame.
     * Although the finalization process of the garbage collector
     * also disposes of the same system resources, it is preferable
     * to manually free the associated resources by calling this
     * method rather than to rely on a finalization process which
     * may not run to completion for a long period of time.
     * &lt;p&gt;
     * Graphics objects which are provided as arguments to the
     * &lt;code&gt;paint&lt;/code&gt; and &lt;code&gt;update&lt;/code&gt; methods
     * of components are automatically released by the system when
     * those methods return. For efficiency, programmers should
     * call &lt;code&gt;dispose&lt;/code&gt; when finished using
     * a &lt;code&gt;Graphics&lt;/code&gt; object only if it was created
     * directly from a component or another &lt;code&gt;Graphics&lt;/code&gt; object.
     * @see         java.awt.Graphics#finalize
     * @see         java.awt.Component#paint
     * @see         java.awt.Component#update
     * @see         java.awt.Component#getGraphics
     * @see         java.awt.Graphics#create()
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>dispose</name><parameter_list>()</parameter_list> <block>{<block_content>
        <expr_stmt><expr><call><name><name>this</name><operator>.</operator><name>domTreeManager</name><operator>.</operator><name>removeGroupManager</name></name><argument_list>(<argument><expr><name><name>this</name><operator>.</operator><name>domGroupManager</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Strokes the outline of a &lt;code&gt;Shape&lt;/code&gt; using the settings of the
     * current &lt;code&gt;Graphics2D&lt;/code&gt; context.  The rendering attributes
     * applied include the &lt;code&gt;Clip&lt;/code&gt;, &lt;code&gt;Transform&lt;/code&gt;,
     * &lt;code&gt;Paint&lt;/code&gt;, &lt;code&gt;Composite&lt;/code&gt; and
     * &lt;code&gt;Stroke&lt;/code&gt; attributes.
     * @param s the &lt;code&gt;Shape&lt;/code&gt; to be rendered
     * @see #setStroke(Stroke)
     * @see #setPaint(Paint)
     * @see java.awt.Graphics#setColor
     * @see #setTransform(AffineTransform)
     * @see #setClip(Shape)
     * @see #setComposite(java.awt.Composite)
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>draw</name><parameter_list>(<parameter><decl><type><name>Shape</name></type> <name>s</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <comment type="line">// Only BasicStroke can be converted to an SVG attribute equivalent.</comment>
        <comment type="line">// If the GraphicContext's Stroke is not an instance of BasicStroke,</comment>
        <comment type="line">// then the stroked outline is filled.</comment>
        <decl_stmt><decl><type><name>Stroke</name></type> <name>stroke</name> <init>= <expr><call><name><name>gc</name><operator>.</operator><name>getStroke</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <if_stmt><if>if <condition>(<expr><name>stroke</name> <operator>instanceof</operator> <name>BasicStroke</name></expr>)</condition> <block>{<block_content>
            <decl_stmt><decl><type><name>Element</name></type> <name>svgShape</name> <init>= <expr><call><name><name>shapeConverter</name><operator>.</operator><name>toSVG</name></name><argument_list>(<argument><expr><name>s</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
            <if_stmt><if>if <condition>(<expr><name>svgShape</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
                <expr_stmt><expr><call><name><name>domGroupManager</name><operator>.</operator><name>addElement</name></name><argument_list>(<argument><expr><name>svgShape</name></expr></argument>, <argument><expr><name><name>DOMGroupManager</name><operator>.</operator><name>DRAW</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block></if></if_stmt>
        </block_content>}</block></if> <else>else <block>{<block_content>
            <decl_stmt><decl><type><name>Shape</name></type> <name>strokedShape</name> <init>= <expr><call><name><name>stroke</name><operator>.</operator><name>createStrokedShape</name></name><argument_list>(<argument><expr><name>s</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
            <expr_stmt><expr><call><name>fill</name><argument_list>(<argument><expr><name>strokedShape</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></else></if_stmt>
    </block_content>}</block></function>


    <comment type="block" format="javadoc">/**
     * Renders an image, applying a transform from image space into user space
     * before drawing.
     * The transformation from user space into device space is done with
     * the current &lt;code&gt;Transform&lt;/code&gt; in the &lt;code&gt;Graphics2D&lt;/code&gt;.
     * The specified transformation is applied to the image before the
     * transform attribute in the &lt;code&gt;Graphics2D&lt;/code&gt; context is applied.
     * The rendering attributes applied include the &lt;code&gt;Clip&lt;/code&gt;,
     * &lt;code&gt;Transform&lt;/code&gt;, and &lt;code&gt;Composite&lt;/code&gt; attributes.
     * Note that no rendering is done if the specified transform is
     * noninvertible.
     * @param img the &lt;code&gt;Image&lt;/code&gt; to be rendered
     * @param xform the transformation from image space into user space
     * @param obs the {@link ImageObserver}
     * to be notified as more of the &lt;code&gt;Image&lt;/code&gt;
     * is converted
     * @return &lt;code&gt;true&lt;/code&gt; if the &lt;code&gt;Image&lt;/code&gt; is
     * fully loaded and completely rendered;
     * &lt;code&gt;false&lt;/code&gt; if the &lt;code&gt;Image&lt;/code&gt; is still being loaded.
     * @see #setTransform(AffineTransform)
     * @see #setComposite(java.awt.Composite)
     * @see #setClip(Shape)
     */</comment>
    <function><type><specifier>public</specifier> <name>boolean</name></type> <name>drawImage</name><parameter_list>(<parameter><decl><type><name>Image</name></type> <name>img</name></decl></parameter>,
                             <parameter><decl><type><name>AffineTransform</name></type> <name>xform</name></decl></parameter>,
                             <parameter><decl><type><name>ImageObserver</name></type> <name>obs</name></decl></parameter>)</parameter_list><block>{<block_content>
        <decl_stmt><decl><type><name>boolean</name></type> <name>retVal</name> <init>= <expr><literal type="boolean">true</literal></expr></init></decl>;</decl_stmt>

        <if_stmt><if>if <condition>(<expr><name>xform</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
            <expr_stmt><expr><name>retVal</name> <operator>=</operator> <call><name>drawImage</name><argument_list>(<argument><expr><name>img</name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if> <if type="elseif">else if<condition>(<expr><call><name><name>xform</name><operator>.</operator><name>getDeterminant</name></name><argument_list>()</argument_list></call> <operator>!=</operator> <literal type="number">0</literal></expr>)</condition><block>{<block_content>
            <decl_stmt><decl><type><name>AffineTransform</name></type> <name>inverseTransform</name> <init>= <expr><literal type="null">null</literal></expr></init></decl>;</decl_stmt>
            <try>try<block>{<block_content>
                <expr_stmt><expr><name>inverseTransform</name> <operator>=</operator> <call><name><name>xform</name><operator>.</operator><name>createInverse</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block>   <catch>catch<parameter_list>(<parameter><decl><type><name>NoninvertibleTransformException</name></type> <name>e</name></decl></parameter>)</parameter_list><block>{<block_content>
                <comment type="line">// Should never happen since we checked the</comment>
                <comment type="line">// matrix determinant</comment>
                <throw>throw <expr><operator>new</operator> <call><name>SVGGraphics2DRuntimeException</name><argument_list>(<argument><expr><name>ERR_UNEXPECTED</name></expr></argument>)</argument_list></call></expr>;</throw>
            </block_content>}</block></catch></try>

            <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>transform</name></name><argument_list>(<argument><expr><name>xform</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><name>retVal</name> <operator>=</operator> <call><name>drawImage</name><argument_list>(<argument><expr><name>img</name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>transform</name></name><argument_list>(<argument><expr><name>inverseTransform</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if> <else>else <block>{<block_content>
            <decl_stmt><decl><type><name>AffineTransform</name></type> <name>savTransform</name> <init>= <expr><operator>new</operator> <call><name>AffineTransform</name><argument_list>(<argument><expr><call><name><name>gc</name><operator>.</operator><name>getTransform</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
            <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>transform</name></name><argument_list>(<argument><expr><name>xform</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><name>retVal</name> <operator>=</operator> <call><name>drawImage</name><argument_list>(<argument><expr><name>img</name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>setTransform</name></name><argument_list>(<argument><expr><name>savTransform</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></else></if_stmt>

        <return>return <expr><name>retVal</name></expr>;</return>

    </block_content>}</block></function>


    <comment type="block" format="javadoc">/**
     * Renders a &lt;code&gt;BufferedImage&lt;/code&gt; that is
     * filtered with a
     * {@link BufferedImageOp}.
     * The rendering attributes applied include the &lt;code&gt;Clip&lt;/code&gt;,
     * &lt;code&gt;Transform&lt;/code&gt;
     * and &lt;code&gt;Composite&lt;/code&gt; attributes.  This is equivalent to:
     * &lt;pre&gt;
     * img1 = op.filter(img, null);
     * drawImage(img1, new AffineTransform(1f,0f,0f,1f,x,y), null);
     * &lt;/pre&gt;
     * @param op the filter to be applied to the image before rendering
     * @param img the &lt;code&gt;BufferedImage&lt;/code&gt; to be rendered
     * @param x the x coordinate in user space where the upper left
     *          corner of the image is rendered
     * @param y the y coordinate in user space where the upper left
     *          corner of the image is rendered
     * @see #setTransform(AffineTransform)
     * @see #setComposite(java.awt.Composite)
     * @see #setClip(Shape)
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>drawImage</name><parameter_list>(<parameter><decl><type><name>BufferedImage</name></type> <name>img</name></decl></parameter>,
                          <parameter><decl><type><name>BufferedImageOp</name></type> <name>op</name></decl></parameter>,
                          <parameter><decl><type><name>int</name></type> <name>x</name></decl></parameter>,
                          <parameter><decl><type><name>int</name></type> <name>y</name></decl></parameter>)</parameter_list><block>{<block_content>
        <comment type="line">//</comment>
        <comment type="line">// Only convert if the input image is of type sRGB</comment>
        <comment type="line">// non-premultiplied</comment>
        <comment type="line">//</comment>
        <comment type="block">/*if(img.getType() == BufferedImage.TYPE_INT_ARGB){
            //
            // There are two special cases: AffineTransformOp and
            // ColorConvertOp. If the input op is not one of these
            // two, then SVGBufferedImageOp is requested to map the
            // filter to an SVG equivalent.
            //
            if(op instanceof AffineTransformOp){
                AffineTransformOp transformOp = (AffineTransformOp)op;
                AffineTransform transform = transformOp.getTransform();

                if(transform.getDeterminant() != 0){
                    AffineTransform inverseTransform = null;
                    try{
                        inverseTransform = transform.createInverse();
                    }catch(NoninvertibleTransformException e){
                        // This should never happen since we checked the
                        // matrix determinant
                        throw new SVGGraphics2DRuntimeException(ERR_UNEXPECTED);
                    }
                    gc.transform(transform);
                    drawImage(img, x, y, null);
                    gc.transform(inverseTransform);
                }
                else{
                    AffineTransform savTransform =
                    new AffineTransform(gc.getTransform());
                    gc.transform(transform);
                    drawImage(img, x, y, null);
                    gc.setTransform(savTransform);
                }
            }
            else if(op instanceof ColorConvertOp){
                img = op.filter(img, null);
                drawImage(img, x, y, null);
            }
            else{
                //
                // Try and convert to an SVG filter
                //
                SVGFilterDescriptor filterDesc =
                domTreeManager.getFilterConverter().toSVG(op, null);
                if(filterDesc != null){
                //
                // Because other filters may be needed to represent the
                // composite that applies to this image, a group is created that
                // contains the image element.
                //
                Element imageElement =
                getDOMFactory().
                createElementNS(SVG_NAMESPACE_URI, SVG_IMAGE_TAG);
                getImageHandler().handleImage((Image)img, imageElement,
                generatorCtx);
                imageElement.setAttributeNS(null, SVG_X_ATTRIBUTE,
                Integer.toString(x));
                imageElement.setAttributeNS(null, SVG_Y_ATTRIBUTE,
                Integer.toString(y));
                imageElement.setAttributeNS(null, SVG_WIDTH_ATTRIBUTE,
                Integer.toString(img.getWidth(null)));
                imageElement.setAttributeNS(null, SVG_HEIGHT_ATTRIBUTE,
                Integer.toString(img.getHeight(null)));
                imageElement.setAttributeNS(null, SVG_FILTER_ATTRIBUTE,
                filterDesc.getFilterValue());
                Element imageGroup = generatorCtx.domFactory.createElementNS(SVG_NAMESPACE_URI,
                SVG_G_TAG);
                imageGroup.appendChild(imageElement);

                    domGroupManager.addElement(imageGroup);
                }
                else{
                    //
                    // Could not convert to an equivalent SVG filter:
                    // filter now and draw resulting image
                    //
                    img = op.filter(img, null);
                    drawImage(img, x, y, null);
                }
            }
        }
        else{*/</comment>
            <comment type="line">//</comment>
            <comment type="line">// Input image is not sRGB non premultiplied.</comment>
            <comment type="line">// Do not try conversion: apply filter and paint</comment>
            <comment type="line">//</comment>
        <expr_stmt><expr><name>img</name> <operator>=</operator> <call><name><name>op</name><operator>.</operator><name>filter</name></name><argument_list>(<argument><expr><name>img</name></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name>drawImage</name><argument_list>(<argument><expr><name>img</name></expr></argument>, <argument><expr><name>x</name></expr></argument>, <argument><expr><name>y</name></expr></argument>, <argument><expr><literal type="null">null</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <comment type="line">// }</comment>
    </block_content>}</block></function>


    <comment type="block" format="javadoc">/**
     * Renders a {@link RenderedImage},
     * applying a transform from image
     * space into user space before drawing.
     * The transformation from user space into device space is done with
     * the current &lt;code&gt;Transform&lt;/code&gt; in the &lt;code&gt;Graphics2D&lt;/code&gt;.
     * The specified transformation is applied to the image before the
     * transform attribute in the &lt;code&gt;Graphics2D&lt;/code&gt; context is applied.
     * The rendering attributes applied include the &lt;code&gt;Clip&lt;/code&gt;,
     * &lt;code&gt;Transform&lt;/code&gt;, and &lt;code&gt;Composite&lt;/code&gt; attributes. Note
     * that no rendering is done if the specified transform is
     * noninvertible.
     * @param img the image to be rendered
     * @param trans2 the transformation from image space into user space
     * @see #setTransform(AffineTransform)
     * @see #setComposite(java.awt.Composite)
     * @see #setClip(Shape)
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>drawRenderedImage</name><parameter_list>(<parameter><decl><type><name>RenderedImage</name></type> <name>img</name></decl></parameter>,
                                  <parameter><decl><type><name>AffineTransform</name></type> <name>trans2</name></decl></parameter>)</parameter_list> <block>{<block_content>

        <decl_stmt><decl><type><name>Element</name></type> <name>image</name> <init>=
            <expr><call><name>getGenericImageHandler</name><argument_list>()</argument_list></call><operator>.</operator><call><name>createElement</name><argument_list>(<argument><expr><call><name>getGeneratorContext</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>AffineTransform</name></type> <name>trans1</name>
            <init>= <expr><call><name>getGenericImageHandler</name><argument_list>()</argument_list></call><operator>.</operator><call><name>handleImage</name><argument_list>(
                                       <argument><expr><name>img</name></expr></argument>, <argument><expr><name>image</name></expr></argument>,
                                       <argument><expr><call><name><name>img</name><operator>.</operator><name>getMinX</name></name><argument_list>()</argument_list></call></expr></argument>,
                                       <argument><expr><call><name><name>img</name><operator>.</operator><name>getMinY</name></name><argument_list>()</argument_list></call></expr></argument>,
                                       <argument><expr><call><name><name>img</name><operator>.</operator><name>getWidth</name></name><argument_list>()</argument_list></call></expr></argument>,
                                       <argument><expr><call><name><name>img</name><operator>.</operator><name>getHeight</name></name><argument_list>()</argument_list></call></expr></argument>,
                                       <argument><expr><call><name>getGeneratorContext</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

        <decl_stmt><decl><type><name>AffineTransform</name></type> <name>xform</name></decl>;</decl_stmt>

        <comment type="line">// Concatenate the transformation we receive from the imageHandler</comment>
        <comment type="line">// to the user-supplied one. Be aware that both may be null.</comment>
        <if_stmt><if>if <condition>(<expr><name>trans2</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
            <expr_stmt><expr><name>xform</name> <operator>=</operator> <name>trans1</name></expr>;</expr_stmt>
        </block_content>}</block></if> <else>else <block>{<block_content>
            <if_stmt><if>if<condition>(<expr><name>trans1</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
                <expr_stmt><expr><name>xform</name> <operator>=</operator> <name>trans2</name></expr>;</expr_stmt>
             </block_content>}</block></if> <else>else <block>{<block_content>
                <expr_stmt><expr><name>xform</name> <operator>=</operator> <operator>new</operator> <call><name>AffineTransform</name><argument_list>(<argument><expr><name>trans2</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
                <expr_stmt><expr><call><name><name>xform</name><operator>.</operator><name>concatenate</name></name><argument_list>(<argument><expr><name>trans1</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block></else></if_stmt>
        </block_content>}</block></else></if_stmt>

        <if_stmt><if>if<condition>(<expr><name>xform</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
            <expr_stmt><expr><call><name><name>domGroupManager</name><operator>.</operator><name>addElement</name></name><argument_list>(<argument><expr><name>image</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if> <if type="elseif">else if<condition>(<expr><call><name><name>xform</name><operator>.</operator><name>getDeterminant</name></name><argument_list>()</argument_list></call> <operator>!=</operator> <literal type="number">0</literal></expr>)</condition><block>{<block_content>
            <decl_stmt><decl><type><name>AffineTransform</name></type> <name>inverseTransform</name> <init>= <expr><literal type="null">null</literal></expr></init></decl>;</decl_stmt>
            <try>try<block>{<block_content>
                <expr_stmt><expr><name>inverseTransform</name> <operator>=</operator> <call><name><name>xform</name><operator>.</operator><name>createInverse</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block><catch>catch<parameter_list>(<parameter><decl><type><name>NoninvertibleTransformException</name></type> <name>e</name></decl></parameter>)</parameter_list><block>{<block_content>
                <comment type="line">// This should never happen since we checked</comment>
                <comment type="line">// the matrix determinant</comment>
                <throw>throw <expr><operator>new</operator> <call><name>SVGGraphics2DRuntimeException</name><argument_list>(<argument><expr><name>ERR_UNEXPECTED</name></expr></argument>)</argument_list></call></expr>;</throw>
            </block_content>}</block></catch></try>
            <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>transform</name></name><argument_list>(<argument><expr><name>xform</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>domGroupManager</name><operator>.</operator><name>addElement</name></name><argument_list>(<argument><expr><name>image</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>transform</name></name><argument_list>(<argument><expr><name>inverseTransform</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if> <else>else <block>{<block_content>
            <decl_stmt><decl><type><name>AffineTransform</name></type> <name>savTransform</name> <init>= <expr><operator>new</operator> <call><name>AffineTransform</name><argument_list>(<argument><expr><call><name><name>gc</name><operator>.</operator><name>getTransform</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
            <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>transform</name></name><argument_list>(<argument><expr><name>xform</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>domGroupManager</name><operator>.</operator><name>addElement</name></name><argument_list>(<argument><expr><name>image</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>setTransform</name></name><argument_list>(<argument><expr><name>savTransform</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></else></if_stmt>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Renders a
     * {@link RenderableImage},
     * applying a transform from image space into user space before drawing.
     * The transformation from user space into device space is done with
     * the current &lt;code&gt;Transform&lt;/code&gt; in the &lt;code&gt;Graphics2D&lt;/code&gt;.
     * The specified transformation is applied to the image before the
     * transform attribute in the &lt;code&gt;Graphics2D&lt;/code&gt; context is applied.
     * The rendering attributes applied include the &lt;code&gt;Clip&lt;/code&gt;,
     * &lt;code&gt;Transform&lt;/code&gt;, and &lt;code&gt;Composite&lt;/code&gt; attributes. Note
     * that no rendering is done if the specified transform is
     * noninvertible.
     * &lt;p&gt;
     * Rendering hints set on the &lt;code&gt;Graphics2D&lt;/code&gt; object might
     * be used in rendering the &lt;code&gt;RenderableImage&lt;/code&gt;.
     * If explicit control is required over specific hints recognized by a
     * specific &lt;code&gt;RenderableImage&lt;/code&gt;, or if knowledge of which hints
     * are used is required, then a &lt;code&gt;RenderedImage&lt;/code&gt; should be
     * obtained directly from the &lt;code&gt;RenderableImage&lt;/code&gt;
     * and rendered using
     * {@link #drawRenderedImage(RenderedImage, AffineTransform)}.
     * @param img the image to be rendered
     * @param trans2 the transformation from image space into user space
     * @see #setTransform(AffineTransform)
     * @see #setComposite(java.awt.Composite)
     * @see #setClip(Shape)
     * @see #drawRenderedImage
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>drawRenderableImage</name><parameter_list>(<parameter><decl><type><name>RenderableImage</name></type> <name>img</name></decl></parameter>,
                                    <parameter><decl><type><name>AffineTransform</name></type> <name>trans2</name></decl></parameter>)</parameter_list><block>{<block_content>

        <decl_stmt><decl><type><name>Element</name></type> <name>image</name> <init>=
            <expr><call><name>getGenericImageHandler</name><argument_list>()</argument_list></call><operator>.</operator><call><name>createElement</name><argument_list>(<argument><expr><call><name>getGeneratorContext</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

        <decl_stmt><decl><type><name>AffineTransform</name></type> <name>trans1</name> <init>=
            <expr><call><name>getGenericImageHandler</name><argument_list>()</argument_list></call><operator>.</operator><call><name>handleImage</name><argument_list>(
                                     <argument><expr><name>img</name></expr></argument>, <argument><expr><name>image</name></expr></argument>,
                                     <argument><expr><call><name><name>img</name><operator>.</operator><name>getMinX</name></name><argument_list>()</argument_list></call></expr></argument>,
                                     <argument><expr><call><name><name>img</name><operator>.</operator><name>getMinY</name></name><argument_list>()</argument_list></call></expr></argument>,
                                     <argument><expr><call><name><name>img</name><operator>.</operator><name>getWidth</name></name><argument_list>()</argument_list></call></expr></argument>,
                                     <argument><expr><call><name><name>img</name><operator>.</operator><name>getHeight</name></name><argument_list>()</argument_list></call></expr></argument>,
                                     <argument><expr><call><name>getGeneratorContext</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

        <decl_stmt><decl><type><name>AffineTransform</name></type> <name>xform</name></decl>;</decl_stmt>

        <comment type="line">// Concatenate the transformation we receive from the imageHandler</comment>
        <comment type="line">// to the user-supplied one. Be aware that both may be null.</comment>
        <if_stmt><if>if <condition>(<expr><name>trans2</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
            <expr_stmt><expr><name>xform</name> <operator>=</operator> <name>trans1</name></expr>;</expr_stmt>
        </block_content>}</block></if> <else>else <block>{<block_content>
            <if_stmt><if>if<condition>(<expr><name>trans1</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
                <expr_stmt><expr><name>xform</name> <operator>=</operator> <name>trans2</name></expr>;</expr_stmt>
             </block_content>}</block></if> <else>else <block>{<block_content>
                <expr_stmt><expr><name>xform</name> <operator>=</operator> <operator>new</operator> <call><name>AffineTransform</name><argument_list>(<argument><expr><name>trans2</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
                <expr_stmt><expr><call><name><name>xform</name><operator>.</operator><name>concatenate</name></name><argument_list>(<argument><expr><name>trans1</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block></else></if_stmt>
        </block_content>}</block></else></if_stmt>

        <if_stmt><if>if <condition>(<expr><name>xform</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
            <expr_stmt><expr><call><name><name>domGroupManager</name><operator>.</operator><name>addElement</name></name><argument_list>(<argument><expr><name>image</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if> <if type="elseif">else if<condition>(<expr><call><name><name>xform</name><operator>.</operator><name>getDeterminant</name></name><argument_list>()</argument_list></call> <operator>!=</operator> <literal type="number">0</literal></expr>)</condition><block>{<block_content>
            <decl_stmt><decl><type><name>AffineTransform</name></type> <name>inverseTransform</name> <init>= <expr><literal type="null">null</literal></expr></init></decl>;</decl_stmt>
            <try>try<block>{<block_content>
                <expr_stmt><expr><name>inverseTransform</name> <operator>=</operator> <call><name><name>xform</name><operator>.</operator><name>createInverse</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block><catch>catch<parameter_list>(<parameter><decl><type><name>NoninvertibleTransformException</name></type> <name>e</name></decl></parameter>)</parameter_list><block>{<block_content>
                <comment type="line">// This should never happen because we checked the</comment>
                <comment type="line">// matrix determinant</comment>
                <throw>throw <expr><operator>new</operator> <call><name>SVGGraphics2DRuntimeException</name><argument_list>(<argument><expr><name>ERR_UNEXPECTED</name></expr></argument>)</argument_list></call></expr>;</throw>
            </block_content>}</block></catch></try>
            <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>transform</name></name><argument_list>(<argument><expr><name>xform</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>domGroupManager</name><operator>.</operator><name>addElement</name></name><argument_list>(<argument><expr><name>image</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>transform</name></name><argument_list>(<argument><expr><name>inverseTransform</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if> <else>else <block>{<block_content>
            <decl_stmt><decl><type><name>AffineTransform</name></type> <name>savTransform</name> <init>= <expr><operator>new</operator> <call><name>AffineTransform</name><argument_list>(<argument><expr><call><name><name>gc</name><operator>.</operator><name>getTransform</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
            <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>transform</name></name><argument_list>(<argument><expr><name>xform</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>domGroupManager</name><operator>.</operator><name>addElement</name></name><argument_list>(<argument><expr><name>image</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>gc</name><operator>.</operator><name>setTransform</name></name><argument_list>(<argument><expr><name>savTransform</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></else></if_stmt>
    </block_content>}</block></function>


    <comment type="block" format="javadoc">/**
     * Renders the text specified by the specified &lt;code&gt;String&lt;/code&gt;,
     * using the current &lt;code&gt;Font&lt;/code&gt; and &lt;code&gt;Paint&lt;/code&gt; attributes
     * in the &lt;code&gt;Graphics2D&lt;/code&gt; context.
     * The baseline of the first character is at position
     * (&lt;i&gt;x&lt;/i&gt;,&amp;nbsp;&lt;i&gt;y&lt;/i&gt;) in the User Space.
     * The rendering attributes applied include the &lt;code&gt;Clip&lt;/code&gt;,
     * &lt;code&gt;Transform&lt;/code&gt;, &lt;code&gt;Paint&lt;/code&gt;, &lt;code&gt;Font&lt;/code&gt; and
     * &lt;code&gt;Composite&lt;/code&gt; attributes. For characters in script systems
     * such as Hebrew and Arabic, the glyphs can be rendered from right to
     * left, in which case the coordinate supplied is the location of the
     * leftmost character on the baseline.
     * @param s the &lt;code&gt;String&lt;/code&gt; to be rendered
     * @param x the x coordinate where the &lt;code&gt;String&lt;/code&gt;
     *          should be rendered
     * @param y the y coordinate where the &lt;code&gt;String&lt;/code&gt;
     *          should be rendered
     * @see #setPaint(Paint)
     * @see java.awt.Graphics#setColor
     * @see java.awt.Graphics#setFont
     * @see #setTransform(AffineTransform)
     * @see #setComposite(java.awt.Composite)
     * @see #setClip(Shape)
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>drawString</name><parameter_list>(<parameter><decl><type><name>String</name></type> <name>s</name></decl></parameter>, <parameter><decl><type><name>float</name></type> <name>x</name></decl></parameter>, <parameter><decl><type><name>float</name></type> <name>y</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <if_stmt><if>if <condition>(<expr><name>textAsShapes</name></expr>)</condition>  <block>{<block_content>
            <decl_stmt><decl><type><name>GlyphVector</name></type> <name>gv</name> <init>= <expr><call><name>getFont</name><argument_list>()</argument_list></call><operator>.</operator>
                <call><name>createGlyphVector</name><argument_list>(<argument><expr><call><name>getFontRenderContext</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>s</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
            <expr_stmt><expr><call><name>drawGlyphVector</name><argument_list>(<argument><expr><name>gv</name></expr></argument>, <argument><expr><name>x</name></expr></argument>, <argument><expr><name>y</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <return>return;</return>
        </block_content>}</block></if></if_stmt>

        <if_stmt><if>if <condition>(<expr><name><name>generatorCtx</name><operator>.</operator><name>svgFont</name></name></expr>)</condition> <block>{<block_content>
            <comment type="line">// record that the font is being used to draw this</comment>
            <comment type="line">// string, this is so that the SVG Font element will</comment>
            <comment type="line">// only create glyphs for the characters that are</comment>
            <comment type="line">// needed</comment>
            <expr_stmt><expr><call><name><name>domTreeManager</name><operator>.</operator><name>gcConverter</name><operator>.</operator>
                <name>getFontConverter</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>recordFontUsage</name><argument_list>(<argument><expr><name>s</name></expr></argument>, <argument><expr><call><name>getFont</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if></if_stmt>

        <comment type="line">// Account for the font transform if there is one</comment>
        <decl_stmt><decl><type><name>AffineTransform</name></type> <name>savTxf</name> <init>= <expr><call><name>getTransform</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>AffineTransform</name></type> <name>txtTxf</name> <init>= <expr><call><name>transformText</name><argument_list>(<argument><expr><name>x</name></expr></argument>, <argument><expr><name>y</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

        <decl_stmt><decl><type><name>Element</name></type> <name>text</name> <init>=
            <expr><call><name>getDOMFactory</name><argument_list>()</argument_list></call><operator>.</operator><call><name>createElementNS</name><argument_list>(<argument><expr><name>SVG_NAMESPACE_URI</name></expr></argument>, <argument><expr><name>SVG_TEXT_TAG</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <expr_stmt><expr><call><name><name>text</name><operator>.</operator><name>setAttributeNS</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><name>SVG_X_ATTRIBUTE</name></expr></argument>, <argument><expr><call><name><name>generatorCtx</name><operator>.</operator><name>doubleString</name></name><argument_list>(<argument><expr><name>x</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>text</name><operator>.</operator><name>setAttributeNS</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><name>SVG_Y_ATTRIBUTE</name></expr></argument>, <argument><expr><call><name><name>generatorCtx</name><operator>.</operator><name>doubleString</name></name><argument_list>(<argument><expr><name>y</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <expr_stmt><expr><call><name><name>text</name><operator>.</operator><name>setAttributeNS</name></name><argument_list>(<argument><expr><name>XML_NAMESPACE_URI</name></expr></argument>,
                            <argument><expr><name>XML_SPACE_QNAME</name></expr></argument>,
                            <argument><expr><name>XML_PRESERVE_VALUE</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>text</name><operator>.</operator><name>appendChild</name></name><argument_list>(<argument><expr><call><name>getDOMFactory</name><argument_list>()</argument_list></call><operator>.</operator><call><name>createTextNode</name><argument_list>(<argument><expr><name>s</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>domGroupManager</name><operator>.</operator><name>addElement</name></name><argument_list>(<argument><expr><name>text</name></expr></argument>, <argument><expr><name><name>DOMGroupManager</name><operator>.</operator><name>FILL</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <if_stmt><if>if <condition>(<expr><name>txtTxf</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><block>{<block_content>
            <expr_stmt><expr><call><name><name>this</name><operator>.</operator><name>setTransform</name></name><argument_list>(<argument><expr><name>savTxf</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if></if_stmt>
    </block_content>}</block></function>

    <function><type><specifier>private</specifier> <name>AffineTransform</name></type> <name>transformText</name><parameter_list>(<parameter><decl><type><name>float</name></type> <name>x</name></decl></parameter>, <parameter><decl><type><name>float</name></type> <name>y</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <decl_stmt><decl><type><name>AffineTransform</name></type> <name>txtTxf</name> <init>= <expr><literal type="null">null</literal></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>Font</name></type> <name>font</name> <init>= <expr><call><name>getFont</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <if_stmt><if>if <condition>(<expr><name>font</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition><block>{<block_content>
            <expr_stmt><expr><name>txtTxf</name> <operator>=</operator> <call><name><name>font</name><operator>.</operator><name>getTransform</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
            <if_stmt><if>if <condition>(<expr><name>txtTxf</name> <operator>!=</operator> <literal type="null">null</literal> <operator>&amp;&amp;</operator> <operator>!</operator><call><name><name>txtTxf</name><operator>.</operator><name>isIdentity</name></name><argument_list>()</argument_list></call></expr>)</condition><block>{<block_content>
                <comment type="line">//</comment>
                <comment type="line">// The additional transform applies about the text's origin</comment>
                <comment type="line">//</comment>
                <decl_stmt><decl><type><name>AffineTransform</name></type> <name>t</name> <init>= <expr><operator>new</operator> <call><name>AffineTransform</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
                <expr_stmt><expr><call><name><name>t</name><operator>.</operator><name>translate</name></name><argument_list>(<argument><expr><name>x</name></expr></argument>, <argument><expr><name>y</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
                <expr_stmt><expr><call><name><name>t</name><operator>.</operator><name>concatenate</name></name><argument_list>(<argument><expr><name>txtTxf</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
                <expr_stmt><expr><call><name><name>t</name><operator>.</operator><name>translate</name></name><argument_list>(<argument><expr><operator>-</operator><name>x</name></expr></argument>, <argument><expr><operator>-</operator><name>y</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
                <expr_stmt><expr><call><name><name>this</name><operator>.</operator><name>transform</name></name><argument_list>(<argument><expr><name>t</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block></if> <else>else <block>{<block_content>
                <expr_stmt><expr><name>txtTxf</name> <operator>=</operator> <literal type="null">null</literal></expr>;</expr_stmt>
            </block_content>}</block></else></if_stmt>
        </block_content>}</block></if></if_stmt>
        <return>return <expr><name>txtTxf</name></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Renders the text of the specified iterator, using the
     * &lt;code&gt;Graphics2D&lt;/code&gt; context's current &lt;code&gt;Paint&lt;/code&gt;. The
     * iterator must specify a font
     * for each character. The baseline of the
     * first character is at position (&lt;i&gt;x&lt;/i&gt;,&amp;nbsp;&lt;i&gt;y&lt;/i&gt;) in the
     * User Space.
     * The rendering attributes applied include the &lt;code&gt;Clip&lt;/code&gt;,
     * &lt;code&gt;Transform&lt;/code&gt;, &lt;code&gt;Paint&lt;/code&gt;, and
     * &lt;code&gt;Composite&lt;/code&gt; attributes.
     * For characters in script systems such as Hebrew and Arabic,
     * the glyphs can be rendered from right to left, in which case the
     * coordinate supplied is the location of the leftmost character
     * on the baseline.&lt;br&gt;
     *
     *
     * @param ati the iterator whose text is to be rendered
     * @param x the x coordinate where the iterator's text is to be rendered
     * @param y the y coordinate where the iterator's text is to be rendered
     * @see #setPaint(Paint)
     * @see java.awt.Graphics#setColor
     * @see #setTransform(AffineTransform)
     * @see #setComposite(java.awt.Composite)
     * @see #setClip(Shape)
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>drawString</name><parameter_list>(<parameter><decl><type><name>AttributedCharacterIterator</name></type> <name>ati</name></decl></parameter>, <parameter><decl><type><name>float</name></type> <name>x</name></decl></parameter>, <parameter><decl><type><name>float</name></type> <name>y</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <if_stmt><if>if <condition>(<expr><operator>(</operator><name>textAsShapes</name><operator>)</operator> <operator>||</operator> <operator>(</operator><call><name>usesUnsupportedAttributes</name><argument_list>(<argument><expr><name>ati</name></expr></argument>)</argument_list></call><operator>)</operator></expr>)</condition> <block>{<block_content>
            <decl_stmt><decl><type><name>TextLayout</name></type> <name>layout</name> <init>= <expr><operator>new</operator> <call><name>TextLayout</name><argument_list>(<argument><expr><name>ati</name></expr></argument>, <argument><expr><call><name>getFontRenderContext</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
            <expr_stmt><expr><call><name><name>layout</name><operator>.</operator><name>draw</name></name><argument_list>(<argument><expr><name>this</name></expr></argument>, <argument><expr><name>x</name></expr></argument>, <argument><expr><name>y</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <return>return;</return>
        </block_content>}</block></if></if_stmt>
        <comment type="line">// first we want if there is more than one run in this</comment>
        <comment type="line">// ati. This will be used to decide if we create tspan</comment>
        <comment type="line">// Elements under the text Element or not</comment>
        <decl_stmt><decl><type><name>boolean</name></type> <name>multiSpans</name> <init>= <expr><literal type="boolean">false</literal></expr></init></decl>;</decl_stmt>
        <if_stmt><if>if <condition>(<expr><call><name><name>ati</name><operator>.</operator><name>getRunLimit</name></name><argument_list>()</argument_list></call> <operator>&lt;</operator> <call><name><name>ati</name><operator>.</operator><name>getEndIndex</name></name><argument_list>()</argument_list></call></expr>)</condition><block type="pseudo"><block_content> <expr_stmt><expr><name>multiSpans</name> <operator>=</operator> <literal type="boolean">true</literal></expr>;</expr_stmt></block_content></block></if></if_stmt>

        <comment type="line">// create the parent text Element</comment>
        <decl_stmt><decl><type><name>Element</name></type> <name>text</name> <init>= <expr><call><name>getDOMFactory</name><argument_list>()</argument_list></call><operator>.</operator><call><name>createElementNS</name><argument_list>(<argument><expr><name>SVG_NAMESPACE_URI</name></expr></argument>,
                                                       <argument><expr><name>SVG_TEXT_TAG</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <expr_stmt><expr><call><name><name>text</name><operator>.</operator><name>setAttributeNS</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><name>SVG_X_ATTRIBUTE</name></expr></argument>,
                            <argument><expr><call><name><name>generatorCtx</name><operator>.</operator><name>doubleString</name></name><argument_list>(<argument><expr><name>x</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>text</name><operator>.</operator><name>setAttributeNS</name></name><argument_list>(<argument><expr><literal type="null">null</literal></expr></argument>, <argument><expr><name>SVG_Y_ATTRIBUTE</name></expr></argument>,
                            <argument><expr><call><name><name>generatorCtx</name><operator>.</operator><name>doubleString</name></name><argument_list>(<argument><expr><name>y</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>text</name><operator>.</operator><name>setAttributeNS</name></name><argument_list>(<argument><expr><name>XML_NAMESPACE_URI</name></expr></argument>, <argument><expr><name>XML_SPACE_QNAME</name></expr></argument>,
                            <argument><expr><name>XML_PRESERVE_VALUE</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <decl_stmt><decl><type><name>Font</name></type>  <name>baseFont</name>  <init>= <expr><call><name>getFont</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>Paint</name></type> <name>basePaint</name> <init>= <expr><call><name>getPaint</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>

        <comment type="line">// now iterate through all the runs</comment>
        <decl_stmt><decl><type><name>char</name></type> <name>ch</name> <init>= <expr><call><name><name>ati</name><operator>.</operator><name>first</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>

        <expr_stmt><expr><call><name>setTextElementFill</name>   <argument_list>(<argument><expr><name>ati</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name>setTextFontAttributes</name><argument_list>(<argument><expr><name>ati</name></expr></argument>, <argument><expr><name>baseFont</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <decl_stmt><decl><type><name>SVGGraphicContext</name></type> <name>textGC</name></decl>;</decl_stmt>
        <expr_stmt><expr><name>textGC</name> <operator>=</operator> <call><name><name>domTreeManager</name><operator>.</operator><name>getGraphicContextConverter</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>toSVG</name><argument_list>(<argument><expr><name>gc</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>domGroupManager</name><operator>.</operator><name>addElement</name></name><argument_list>(<argument><expr><name>text</name></expr></argument>, <argument><expr><name><name>DOMGroupManager</name><operator>.</operator><name>FILL</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>textGC</name><operator>.</operator><name>getContext</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>put</name><argument_list>(<argument><expr><name>SVG_STROKE_ATTRIBUTE</name></expr></argument>, <argument><expr><name>SVG_NONE_VALUE</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name><name>textGC</name><operator>.</operator><name>getGroupContext</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>put</name><argument_list>(<argument><expr><name>SVG_STROKE_ATTRIBUTE</name></expr></argument>, <argument><expr><name>SVG_NONE_VALUE</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <decl_stmt><decl><type><name>boolean</name></type> <name>firstSpan</name> <init>= <expr><literal type="boolean">true</literal></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>AffineTransform</name></type> <name>savTxf</name> <init>= <expr><call><name>getTransform</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <decl_stmt><decl><type><name>AffineTransform</name></type> <name>txtTxf</name> <init>= <expr><literal type="null">null</literal></expr></init></decl>;</decl_stmt>
        <while>while <condition>(<expr><name>ch</name> <operator>!=</operator> <name><name>AttributedCharacterIterator</name><operator>.</operator><name>DONE</name></name></expr>)</condition> <block>{<block_content>
            <comment type="line">// first get the text Element or create a child Element if</comment>
            <comment type="line">// we used tspans</comment>
            <decl_stmt><decl><type><name>Element</name></type> <name>tspan</name> <init>= <expr><name>text</name></expr></init></decl>;</decl_stmt>
            <if_stmt><if>if <condition>(<expr><name>multiSpans</name></expr>)</condition> <block>{<block_content>
                <expr_stmt><expr><name>tspan</name> <operator>=</operator> <call><name>getDOMFactory</name><argument_list>()</argument_list></call><operator>.</operator><call><name>createElementNS</name>
                    <argument_list>(<argument><expr><name>SVG_NAMESPACE_URI</name></expr></argument>, <argument><expr><name>SVG_TSPAN_TAG</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
                <expr_stmt><expr><call><name><name>text</name><operator>.</operator><name>appendChild</name></name><argument_list>(<argument><expr><name>tspan</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block></if></if_stmt>

            <comment type="line">// decorate the tspan Element :</comment>
            <expr_stmt><expr><call><name>setTextElementFill</name><argument_list>(<argument><expr><name>ati</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <decl_stmt><decl><type><name>boolean</name></type> <name>resetTransform</name> <init>= <expr><call><name>setTextFontAttributes</name><argument_list>(<argument><expr><name>ati</name></expr></argument>, <argument><expr><name>baseFont</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

            <comment type="line">// management of font attributes</comment>
            <if_stmt><if>if <condition>(<expr><name>resetTransform</name> <operator>||</operator> <name>firstSpan</name></expr>)</condition> <block>{<block_content>
                <comment type="line">// Account for the font transform if there is one</comment>
                <expr_stmt><expr><name>txtTxf</name> <operator>=</operator> <call><name>transformText</name><argument_list>(<argument><expr><name>x</name></expr></argument>, <argument><expr><name>y</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
                <expr_stmt><expr><name>firstSpan</name> <operator>=</operator> <literal type="boolean">false</literal></expr>;</expr_stmt>
            </block_content>}</block></if></if_stmt>

            <comment type="line">// retrieve the current span of text for the run</comment>
            <decl_stmt><decl><type><name>int</name></type> <name>start</name> <init>= <expr><call><name><name>ati</name><operator>.</operator><name>getIndex</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
            <decl_stmt><decl><type><name>int</name></type> <name>end</name>   <init>= <expr><call><name><name>ati</name><operator>.</operator><name>getRunLimit</name></name><argument_list>()</argument_list></call><operator>-</operator><literal type="number">1</literal></expr></init></decl>;</decl_stmt>

            <decl_stmt><decl><type><name>StringBuffer</name></type> <name>buf</name> <init>= <expr><operator>new</operator> <call><name>StringBuffer</name><argument_list>( <argument><expr><name>end</name> <operator>-</operator> <name>start</name></expr></argument> )</argument_list></call></expr></init></decl>;</decl_stmt>
            <expr_stmt><expr><call><name><name>buf</name><operator>.</operator><name>append</name></name><argument_list>(<argument><expr><name>ch</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

            <for>for <control>(<init><decl><type><name>int</name></type> <name>i</name><init>=<expr><name>start</name></expr></init></decl>;</init> <condition><expr><name>i</name><operator>&lt;</operator><name>end</name></expr>;</condition> <incr><expr><name>i</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>
                <expr_stmt><expr><name>ch</name> <operator>=</operator> <call><name><name>ati</name><operator>.</operator><name>next</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
                <expr_stmt><expr><call><name><name>buf</name><operator>.</operator><name>append</name></name><argument_list>(<argument><expr><name>ch</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block></for>

            <decl_stmt><decl><type><name>String</name></type> <name>s</name> <init>= <expr><call><name><name>buf</name><operator>.</operator><name>toString</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
            <if_stmt><if>if <condition>(<expr><call><name><name>generatorCtx</name><operator>.</operator><name>isEmbeddedFontsOn</name></name><argument_list>()</argument_list></call></expr>)</condition> <block>{<block_content>
                <comment type="line">// record that the font is being used to draw this</comment>
                <comment type="line">// string, this is so that the SVG Font element will</comment>
                <comment type="line">// only create glyphs for the characters that are</comment>
                <comment type="line">// needed</comment>
                <expr_stmt><expr><call><name>getDOMTreeManager</name><argument_list>()</argument_list></call><operator>.</operator><call><name>getGraphicContextConverter</name><argument_list>()</argument_list></call><operator>.</operator>
                    <call><name>getFontConverter</name><argument_list>()</argument_list></call><operator>.</operator><call><name>recordFontUsage</name><argument_list>(<argument><expr><name>s</name></expr></argument>, <argument><expr><call><name>getFont</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block></if></if_stmt>

            <comment type="line">// This must come after registering font usage other</comment>
            <comment type="line">// wise it doesn't know what chars were used.</comment>
            <decl_stmt><decl><type><name>SVGGraphicContext</name></type> <name>elementGC</name></decl>;</decl_stmt>
            <expr_stmt><expr><name>elementGC</name> <operator>=</operator> <call><name><name>domTreeManager</name><operator>.</operator><name>gcConverter</name><operator>.</operator><name>toSVG</name></name><argument_list>(<argument><expr><name>gc</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>elementGC</name><operator>.</operator><name>getGroupContext</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>put</name><argument_list>(<argument><expr><name>SVG_STROKE_ATTRIBUTE</name></expr></argument>,
                                            <argument><expr><name>SVG_NONE_VALUE</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

            <decl_stmt><decl><type><name>SVGGraphicContext</name></type> <name>deltaGC</name></decl>;</decl_stmt>
            <expr_stmt><expr><name>deltaGC</name> <operator>=</operator> <call><name><name>DOMGroupManager</name><operator>.</operator><name>processDeltaGC</name></name><argument_list>(<argument><expr><name>elementGC</name></expr></argument>, <argument><expr><name>textGC</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

            <comment type="line">// management of underline, strike attributes, etc..</comment>
            <expr_stmt><expr><call><name>setTextElementAttributes</name><argument_list>(<argument><expr><name>deltaGC</name></expr></argument>, <argument><expr><name>ati</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

            <expr_stmt><expr><call><name><name>domTreeManager</name><operator>.</operator><name>getStyleHandler</name></name><argument_list>()</argument_list></call><operator>.</operator>
                <call><name>setStyle</name><argument_list>(<argument><expr><name>tspan</name></expr></argument>, <argument><expr><call><name><name>deltaGC</name><operator>.</operator><name>getContext</name></name><argument_list>()</argument_list></call></expr></argument>,
                         <argument><expr><call><name><name>domTreeManager</name><operator>.</operator><name>getGeneratorContext</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

            <expr_stmt><expr><call><name><name>tspan</name><operator>.</operator><name>appendChild</name></name><argument_list>(<argument><expr><call><name>getDOMFactory</name><argument_list>()</argument_list></call><operator>.</operator><call><name>createTextNode</name><argument_list>(<argument><expr><name>s</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <if_stmt><if>if <condition>(<expr><operator>(</operator><name>resetTransform</name> <operator>||</operator> <name>firstSpan</name><operator>)</operator> <operator>&amp;&amp;</operator> <operator>(</operator><name>txtTxf</name> <operator>!=</operator> <literal type="null">null</literal><operator>)</operator></expr>)</condition> <block>{<block_content>
                <expr_stmt><expr><call><name><name>this</name><operator>.</operator><name>setTransform</name></name><argument_list>(<argument><expr><name>savTxf</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            </block_content>}</block></if></if_stmt>
            <expr_stmt><expr><name>ch</name> <operator>=</operator> <call><name><name>ati</name><operator>.</operator><name>next</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>  <comment type="line">// get first char of next run.</comment>
        </block_content>}</block></while>
        <expr_stmt><expr><call><name>setFont</name><argument_list>(<argument><expr><name>baseFont</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name>setPaint</name><argument_list>(<argument><expr><name>basePaint</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Fills the interior of a &lt;code&gt;Shape&lt;/code&gt; using the settings of the
     * &lt;code&gt;Graphics2D&lt;/code&gt; context. The rendering attributes applied
     * include the &lt;code&gt;Clip&lt;/code&gt;, &lt;code&gt;Transform&lt;/code&gt;,
     * &lt;code&gt;Paint&lt;/code&gt;, and &lt;code&gt;Composite&lt;/code&gt;.
     * @param s the &lt;code&gt;Shape&lt;/code&gt; to be filled
     * @see #setPaint(Paint)
     * @see java.awt.Graphics#setColor
     * @see #setTransform(AffineTransform)
     * @see #setComposite(java.awt.Composite)
     * @see #setClip(Shape)
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>fill</name><parameter_list>(<parameter><decl><type><name>Shape</name></type> <name>s</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <decl_stmt><decl><type><name>Element</name></type> <name>svgShape</name> <init>= <expr><call><name><name>shapeConverter</name><operator>.</operator><name>toSVG</name></name><argument_list>(<argument><expr><name>s</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <if_stmt><if>if <condition>(<expr><name>svgShape</name> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
            <expr_stmt><expr><call><name><name>domGroupManager</name><operator>.</operator><name>addElement</name></name><argument_list>(<argument><expr><name>svgShape</name></expr></argument>, <argument><expr><name><name>DOMGroupManager</name><operator>.</operator><name>FILL</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if></if_stmt>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/** Set the Element Font and Size attributes, depending on the
     * AttributedCharacterIterator attributes.
     */</comment>
    <function><type><specifier>private</specifier> <name>boolean</name></type> <name>setTextFontAttributes</name><parameter_list>(<parameter><decl><type><name>AttributedCharacterIterator</name></type> <name>ati</name></decl></parameter>,
                                          <parameter><decl><type><name>Font</name></type> <name>baseFont</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <decl_stmt><decl><type><name>boolean</name></type> <name>resetTransform</name> <init>= <expr><literal type="boolean">false</literal></expr></init></decl>;</decl_stmt>
        <if_stmt><if>if <condition>(<expr><operator>(</operator><call><name><name>ati</name><operator>.</operator><name>getAttribute</name></name><argument_list>(<argument><expr><name><name>TextAttribute</name><operator>.</operator><name>FONT</name></name></expr></argument>)</argument_list></call> <operator>!=</operator> <literal type="null">null</literal><operator>)</operator> <operator>||</operator>
            <operator>(</operator><call><name><name>ati</name><operator>.</operator><name>getAttribute</name></name><argument_list>(<argument><expr><name><name>TextAttribute</name><operator>.</operator><name>FAMILY</name></name></expr></argument>)</argument_list></call> <operator>!=</operator> <literal type="null">null</literal><operator>)</operator> <operator>||</operator>
            <operator>(</operator><call><name><name>ati</name><operator>.</operator><name>getAttribute</name></name><argument_list>(<argument><expr><name><name>TextAttribute</name><operator>.</operator><name>WEIGHT</name></name></expr></argument>)</argument_list></call> <operator>!=</operator> <literal type="null">null</literal><operator>)</operator> <operator>||</operator>
            <operator>(</operator><call><name><name>ati</name><operator>.</operator><name>getAttribute</name></name><argument_list>(<argument><expr><name><name>TextAttribute</name><operator>.</operator><name>POSTURE</name></name></expr></argument>)</argument_list></call> <operator>!=</operator> <literal type="null">null</literal><operator>)</operator> <operator>||</operator>
            <operator>(</operator><call><name><name>ati</name><operator>.</operator><name>getAttribute</name></name><argument_list>(<argument><expr><name><name>TextAttribute</name><operator>.</operator><name>SIZE</name></name></expr></argument>)</argument_list></call> <operator>!=</operator> <literal type="null">null</literal><operator>)</operator></expr>)</condition> <block>{<block_content>
            <decl_stmt><decl><type><name>Map</name></type> <name>m</name> <init>= <expr><call><name><name>ati</name><operator>.</operator><name>getAttributes</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
            <decl_stmt><decl><type><name>Font</name></type> <name>f</name> <init>= <expr><call><name><name>baseFont</name><operator>.</operator><name>deriveFont</name></name><argument_list>(<argument><expr><name>m</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
            <expr_stmt><expr><call><name>setFont</name><argument_list>(<argument><expr><name>f</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><name>resetTransform</name> <operator>=</operator> <literal type="boolean">true</literal></expr>;</expr_stmt>
        </block_content>}</block></if></if_stmt>

        <return>return <expr><name>resetTransform</name></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/** Set the Element attributes, depending on the AttributedCharacterIterator attributes.
     *  The following attributes are set :
     *  &lt;ul&gt;
     *  &lt;li&gt;underline&lt;/li&gt;
     *  &lt;li&gt;weight (bold or plain)&lt;/li&gt;
     *  &lt;li&gt;style (italic or normal)&lt;/li&gt;
     *  &lt;li&gt;justification (start, end, or middle)&lt;/li&gt;
     *  &lt;/ul&gt;
     */</comment>
    <function><type><specifier>private</specifier> <name>void</name></type> <name>setTextElementFill</name><parameter_list>(<parameter><decl><type><name>AttributedCharacterIterator</name></type> <name>ati</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <if_stmt><if>if <condition>(<expr><call><name><name>ati</name><operator>.</operator><name>getAttribute</name></name><argument_list>(<argument><expr><name><name>TextAttribute</name><operator>.</operator><name>FOREGROUND</name></name></expr></argument>)</argument_list></call> <operator>!=</operator> <literal type="null">null</literal></expr>)</condition> <block>{<block_content>
            <decl_stmt><decl><type><name>Color</name></type> <name>color</name> <init>= <expr><operator>(</operator><name>Color</name><operator>)</operator><call><name><name>ati</name><operator>.</operator><name>getAttribute</name></name><argument_list>(<argument><expr><name><name>TextAttribute</name><operator>.</operator><name>FOREGROUND</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
            <expr_stmt><expr><call><name>setPaint</name><argument_list>(<argument><expr><name>color</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        </block_content>}</block></if></if_stmt>
    </block_content>}</block></function>

    <function><type><specifier>private</specifier> <name>void</name></type> <name>setTextElementAttributes</name><parameter_list>(<parameter><decl><type><name>SVGGraphicContext</name></type> <name>tspanGC</name></decl></parameter>,
                                          <parameter><decl><type><name>AttributedCharacterIterator</name></type> <name>ati</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <decl_stmt><decl><type><name>String</name></type> <name>decoration</name> <init>= <expr><literal type="string">""</literal></expr></init></decl>;</decl_stmt>
        <if_stmt><if>if <condition>(<expr><call><name>isUnderline</name><argument_list>(<argument><expr><name>ati</name></expr></argument>)</argument_list></call></expr>)</condition><block type="pseudo"><block_content>
            <expr_stmt><expr><name>decoration</name> <operator>+=</operator> <name>CSS_UNDERLINE_VALUE</name> <operator>+</operator> <literal type="string">" "</literal></expr>;</expr_stmt></block_content></block></if></if_stmt>
        <if_stmt><if>if <condition>(<expr><call><name>isStrikeThrough</name><argument_list>(<argument><expr><name>ati</name></expr></argument>)</argument_list></call></expr>)</condition><block type="pseudo"><block_content>
            <expr_stmt><expr><name>decoration</name> <operator>+=</operator> <name>CSS_LINE_THROUGH_VALUE</name> <operator>+</operator> <literal type="string">" "</literal></expr>;</expr_stmt></block_content></block></if></if_stmt>
        <decl_stmt><decl><type><name>int</name></type> <name>len</name> <init>= <expr><call><name><name>decoration</name><operator>.</operator><name>length</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <if_stmt><if>if <condition>(<expr><name>len</name> <operator>!=</operator> <literal type="number">0</literal></expr>)</condition><block type="pseudo"><block_content>
            <expr_stmt><expr><call><name><name>tspanGC</name><operator>.</operator><name>getContext</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>put</name><argument_list>(<argument><expr><name>CSS_TEXT_DECORATION_PROPERTY</name></expr></argument>,
                                     <argument><expr><call><name><name>decoration</name><operator>.</operator><name>substring</name></name><argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><name>len</name><operator>-</operator><literal type="number">1</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt></block_content></block></if></if_stmt>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/** Return true if the AttributedCharacterIterator is bold (at its current position).
     */</comment>
    <function><type><specifier>private</specifier> <name>boolean</name></type> <name>isBold</name><parameter_list>(<parameter><decl><type><name>AttributedCharacterIterator</name></type> <name>ati</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <decl_stmt><decl><type><name>Object</name></type> <name>weight</name> <init>= <expr><call><name><name>ati</name><operator>.</operator><name>getAttribute</name></name><argument_list>(<argument><expr><name><name>TextAttribute</name><operator>.</operator><name>WEIGHT</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <if_stmt><if>if <condition>(<expr><name>weight</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition><block type="pseudo"><block_content>
            <return>return <expr><literal type="boolean">false</literal></expr>;</return></block_content></block></if></if_stmt>
        <if_stmt><if>if <condition>(<expr><call><name><name>weight</name><operator>.</operator><name>equals</name></name><argument_list>(<argument><expr><name><name>TextAttribute</name><operator>.</operator><name>WEIGHT_REGULAR</name></name></expr></argument>)</argument_list></call></expr>)</condition><block type="pseudo"><block_content>
            <return>return <expr><literal type="boolean">false</literal></expr>;</return></block_content></block></if></if_stmt>
        <if_stmt><if>if <condition>(<expr><call><name><name>weight</name><operator>.</operator><name>equals</name></name><argument_list>(<argument><expr><name><name>TextAttribute</name><operator>.</operator><name>WEIGHT_DEMILIGHT</name></name></expr></argument>)</argument_list></call></expr>)</condition><block type="pseudo"><block_content>
            <return>return <expr><literal type="boolean">false</literal></expr>;</return></block_content></block></if></if_stmt>
        <if_stmt><if>if <condition>(<expr><call><name><name>weight</name><operator>.</operator><name>equals</name></name><argument_list>(<argument><expr><name><name>TextAttribute</name><operator>.</operator><name>WEIGHT_EXTRA_LIGHT</name></name></expr></argument>)</argument_list></call></expr>)</condition><block type="pseudo"><block_content>
            <return>return <expr><literal type="boolean">false</literal></expr>;</return></block_content></block></if></if_stmt>
        <if_stmt><if>if <condition>(<expr><call><name><name>weight</name><operator>.</operator><name>equals</name></name><argument_list>(<argument><expr><name><name>TextAttribute</name><operator>.</operator><name>WEIGHT_LIGHT</name></name></expr></argument>)</argument_list></call></expr>)</condition><block type="pseudo"><block_content>
            <return>return <expr><literal type="boolean">false</literal></expr>;</return></block_content></block></if></if_stmt>
        <return>return <expr><literal type="boolean">true</literal></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/** Return true if the AttributedCharacterIterator is italic (at
     * its current position).
     */</comment>
    <function><type><specifier>private</specifier> <name>boolean</name></type> <name>isItalic</name><parameter_list>(<parameter><decl><type><name>AttributedCharacterIterator</name></type> <name>ati</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <decl_stmt><decl><type><name>Object</name></type> <name>attr</name> <init>= <expr><call><name><name>ati</name><operator>.</operator><name>getAttribute</name></name><argument_list>(<argument><expr><name><name>TextAttribute</name><operator>.</operator><name>POSTURE</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <if_stmt><if>if <condition>(<expr><call><name><name>TextAttribute</name><operator>.</operator><name>POSTURE_OBLIQUE</name><operator>.</operator><name>equals</name></name><argument_list>(<argument><expr><name>attr</name></expr></argument>)</argument_list></call></expr>)</condition><block type="pseudo"><block_content> <return>return <expr><literal type="boolean">true</literal></expr>;</return></block_content></block></if></if_stmt>
        <return>return <expr><literal type="boolean">false</literal></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/** Return true if the AttributedCharacterIterator is underlined
     * (at its current position).
     */</comment>
    <function><type><specifier>private</specifier> <name>boolean</name></type> <name>isUnderline</name><parameter_list>(<parameter><decl><type><name>AttributedCharacterIterator</name></type> <name>ati</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <decl_stmt><decl><type><name>Object</name></type> <name>attr</name> <init>= <expr><call><name><name>ati</name><operator>.</operator><name>getAttribute</name></name><argument_list>(<argument><expr><name><name>TextAttribute</name><operator>.</operator><name>UNDERLINE</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <return>return <expr><call><name><name>TextAttribute</name><operator>.</operator><name>UNDERLINE_ON</name><operator>.</operator><name>equals</name></name><argument_list>(<argument><expr><name>attr</name></expr></argument>)</argument_list></call></expr>;</return>
        <comment type="line">// What to do about UNDERLINE_LOW_*?  Right now we don't</comment>
        <comment type="line">// draw them since we can't really model them...</comment>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/** Return true if the AttributedCharacterIterator is striked
     * through (at its current position).
     */</comment>
    <function><type><specifier>private</specifier> <name>boolean</name></type> <name>isStrikeThrough</name><parameter_list>(<parameter><decl><type><name>AttributedCharacterIterator</name></type> <name>ati</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <decl_stmt><decl><type><name>Object</name></type> <name>attr</name> <init>= <expr><call><name><name>ati</name><operator>.</operator><name>getAttribute</name></name><argument_list>(<argument><expr><name><name>TextAttribute</name><operator>.</operator><name>STRIKETHROUGH</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <if_stmt><if>if <condition>(<expr><call><name><name>TextAttribute</name><operator>.</operator><name>STRIKETHROUGH_ON</name><operator>.</operator><name>equals</name></name><argument_list>(<argument><expr><name>attr</name></expr></argument>)</argument_list></call></expr>)</condition><block type="pseudo"><block_content> <return>return <expr><literal type="boolean">true</literal></expr>;</return></block_content></block></if></if_stmt>
        <return>return <expr><literal type="boolean">false</literal></expr>;</return>
    </block_content>}</block></function>

    <comment type="block" format="javadoc">/**
     * Returns the device configuration associated with this
     * &lt;code&gt;Graphics2D&lt;/code&gt;.
     */</comment>
    <function><type><specifier>public</specifier> <name>GraphicsConfiguration</name></type> <name>getDeviceConfiguration</name><parameter_list>()</parameter_list><block>{<block_content>
        <comment type="line">// TO BE DONE.</comment>
        <return>return <expr><literal type="null">null</literal></expr>;</return>
    </block_content>}</block></function>

    <comment type="block">/* This is the list of attributes that can't currently be
     * supported by drawString(AttributedCharacterIterator).
     * For accuracy if any of these are present then the
     * text is drawn as outlines.
     */</comment>
    <decl_stmt><decl><type><specifier>protected</specifier> <name>Set</name></type> <name>unsupportedAttributes</name></decl>;</decl_stmt>
    <block>{<block_content>
        <expr_stmt><expr><name>unsupportedAttributes</name> <operator>=</operator> <operator>new</operator> <call><name>HashSet</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
        <constructor_decl><name><name>unsupportedAttributes</name><operator>.</operator><name>add</name></name><parameter_list>(<parameter><decl><type><name><name>TextAttribute</name><operator>.</operator><name>BACKGROUND</name></name></type></decl></parameter>)</parameter_list>;</constructor_decl>
        <constructor_decl><name><name>unsupportedAttributes</name><operator>.</operator><name>add</name></name><parameter_list>(<parameter><decl><type><name><name>TextAttribute</name><operator>.</operator><name>BIDI_EMBEDDING</name></name></type></decl></parameter>)</parameter_list>;</constructor_decl>
        <constructor_decl><name><name>unsupportedAttributes</name><operator>.</operator><name>add</name></name><parameter_list>(<parameter><decl><type><name><name>TextAttribute</name><operator>.</operator><name>CHAR_REPLACEMENT</name></name></type></decl></parameter>)</parameter_list>;</constructor_decl>
        <constructor_decl><name><name>unsupportedAttributes</name><operator>.</operator><name>add</name></name><parameter_list>(<parameter><decl><type><name><name>TextAttribute</name><operator>.</operator><name>JUSTIFICATION</name></name></type></decl></parameter>)</parameter_list>;</constructor_decl>
        <constructor_decl><name><name>unsupportedAttributes</name><operator>.</operator><name>add</name></name><parameter_list>(<parameter><decl><type><name><name>TextAttribute</name><operator>.</operator><name>RUN_DIRECTION</name></name></type></decl></parameter>)</parameter_list>;</constructor_decl>
        <constructor_decl><name><name>unsupportedAttributes</name><operator>.</operator><name>add</name></name><parameter_list>(<parameter><decl><type><name><name>TextAttribute</name><operator>.</operator><name>SUPERSCRIPT</name></name></type></decl></parameter>)</parameter_list>;</constructor_decl>
        <constructor_decl><name><name>unsupportedAttributes</name><operator>.</operator><name>add</name></name><parameter_list>(<parameter><decl><type><name><name>TextAttribute</name><operator>.</operator><name>SWAP_COLORS</name></name></type></decl></parameter>)</parameter_list>;</constructor_decl>
        <constructor_decl><name><name>unsupportedAttributes</name><operator>.</operator><name>add</name></name><parameter_list>(<parameter><decl><type><name><name>TextAttribute</name><operator>.</operator><name>TRANSFORM</name></name></type></decl></parameter>)</parameter_list>;</constructor_decl>
        <constructor_decl><name><name>unsupportedAttributes</name><operator>.</operator><name>add</name></name><parameter_list>(<parameter><decl><type><name><name>TextAttribute</name><operator>.</operator><name>WIDTH</name></name></type></decl></parameter>)</parameter_list>;</constructor_decl>
    </block_content>}</block>

    <comment type="block" format="javadoc">/**
     * This method let's users indicate that they don't care that
     * certain text attributes will not be properly converted to
     * SVG, in exchange when those attributes are used they will
     * get real SVG text instead of paths.
     *
     * @param attrs The set of attrs to treat as unsupported, and
     *              if present cause text to be drawn as paths.
     *              If null ACI text will be rendered as text
     *              (unless 'textAsShapes' is set).
     */</comment>
    <function><type><specifier>public</specifier> <name>void</name></type> <name>setUnsupportedAttributes</name><parameter_list>(<parameter><decl><type><name>Set</name></type> <name>attrs</name></decl></parameter>)</parameter_list> <block>{<block_content>
        <if_stmt><if>if <condition>(<expr><name>attrs</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition><block type="pseudo"><block_content> <expr_stmt><expr><name>unsupportedAttributes</name> <operator>=</operator> <literal type="null">null</literal></expr>;</expr_stmt></block_content></block></if>
        <else>else<block type="pseudo"><block_content>               <expr_stmt><expr><name>unsupportedAttributes</name> <operator>=</operator> <operator>new</operator> <call><name>HashSet</name><argument_list>(<argument><expr><name>attrs</name></expr></argument>)</argument_list></call></expr>;</expr_stmt></block_content></block></else></if_stmt>
    </block_content>}</block></function>

    <function><type><specifier>public</specifier> <name>boolean</name></type> <name>usesUnsupportedAttributes</name><parameter_list>(<parameter><decl><type><name>AttributedCharacterIterator</name></type> <name>aci</name></decl></parameter>)</parameter_list><block>{<block_content>
        <if_stmt><if>if <condition>(<expr><name>unsupportedAttributes</name> <operator>==</operator> <literal type="null">null</literal></expr>)</condition><block type="pseudo"><block_content> <return>return <expr><literal type="boolean">false</literal></expr>;</return></block_content></block></if></if_stmt>

        <decl_stmt><decl><type><name>Set</name></type>      <name>allAttrs</name> <init>= <expr><call><name><name>aci</name><operator>.</operator><name>getAllAttributeKeys</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <for>for <control>(<init><decl><type><name>Object</name></type> <name>allAttr</name> <range>: <expr><name>allAttrs</name></expr></range></decl></init>)</control> <block>{<block_content>
            <if_stmt><if>if <condition>(<expr><call><name><name>unsupportedAttributes</name><operator>.</operator><name>contains</name></name><argument_list>(<argument><expr><name>allAttr</name></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>
                <return>return <expr><literal type="boolean">true</literal></expr>;</return>
            </block_content>}</block></if></if_stmt>
        </block_content>}</block></for>
        <return>return <expr><literal type="boolean">false</literal></expr>;</return>
    </block_content>}</block></function>

}</block></class>
</unit>
